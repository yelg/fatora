import{at as M,r as l,c as P,o as c,a as s,l as t,w as o,aw as O,F as z,ag as K,v as Q,e as x,j as E,f as g,$ as J,g as w,ah as W,i as X,P as V,K as v,L as C,Q as Z,aj as ee,N as te,n as ae,b,m as se,t as L,q as ie,M as ne,S as oe}from"./main-DnObvGgc.js";import{_ as le,a as re,b as me,c as de,d as ue,e as ce,f as pe}from"./SalesTax-CYrASWLJ.js";import{_ as _e}from"./CreateCustomFields-CBKwtRG5.js";import{_ as ge}from"./ExchangeRateConverter-Bb7rrT2I.js";import{_ as fe}from"./TaxTypeModal-Byuj8aRW.js";import"./DragIcon-DZ4DjgJ9.js";import"./SelectNotePopup-D_ZaygaK.js";import"./NoteModal-Dr6YmiAY.js";import"./payment-COlo_rP3.js";import"./exchange-rate-C4tOL1sk.js";const Ee={class:"md:grid-cols-12 grid-cols-1 md:gap-x-6 mt-6 mb-8 grid gap-y-5"},ve={__name:"EstimateCreateBasicFields",props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(i){const e=M();return(f,r)=>{const B=l("BaseCustomerSelectPopup"),m=l("BaseDatePicker"),u=l("BaseInputGroup"),$=l("BaseInput"),h=l("BaseInputGrid");return c(),P("div",Ee,[s(B,{modelValue:t(e).newEstimate.customer,"onUpdate:modelValue":r[0]||(r[0]=d=>t(e).newEstimate.customer=d),valid:i.v.customer_id,"content-loading":i.isLoading,type:"estimate",class:"col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"]),s(h,{class:"col-span-7"},{default:o(()=>[s(u,{label:f.$t("reports.estimates.estimate_date"),"content-loading":i.isLoading,required:"",error:i.v.estimate_date.$error&&i.v.estimate_date.$errors[0].$message},{default:o(()=>[s(m,{modelValue:t(e).newEstimate.estimate_date,"onUpdate:modelValue":r[1]||(r[1]=d=>t(e).newEstimate.estimate_date=d),"content-loading":i.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),s(u,{label:f.$t("estimates.expiry_date"),"content-loading":i.isLoading},{default:o(()=>[s(m,{modelValue:t(e).newEstimate.expiry_date,"onUpdate:modelValue":r[2]||(r[2]=d=>t(e).newEstimate.expiry_date=d),"content-loading":i.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),s(u,{label:f.$t("estimates.estimate_number"),"content-loading":i.isLoading,required:"",error:i.v.estimate_number.$error&&i.v.estimate_number.$errors[0].$message},{default:o(()=>[s($,{modelValue:t(e).newEstimate.estimate_number,"onUpdate:modelValue":r[3]||(r[3]=d=>t(e).newEstimate.estimate_number=d),"content-loading":i.isLoading},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),s(ge,{store:t(e),"store-prop":"newEstimate",v:i.v,"is-loading":i.isLoading,"is-edit":i.isEdit,"customer-currency":t(e).newEstimate.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1})])}}},ye={class:"flex"},we={class:"block mt-10 estimate-foot lg:flex lg:justify-between lg:items-start"},be={class:"relative w-full lg:w-1/2"},k="newEstimate",Le={__name:"EstimateCreate",setup(i){const e=M(),f=O(),r=z(),B=K(),{t:m}=Q.useI18n();let u=x(!1);const $=x(!1),h=x(["customer","company","customerCustom","estimate","estimateCustom"]);let d=te(),F=ae(),p=E(()=>e.isFetchingInitialSettings),T=E(()=>_.value?m("estimates.edit_estimate"):m("estimates.new_estimate")),_=E(()=>d.name==="estimates.edit");const D=E(()=>r.selectedCompanySettings.sales_tax_us_enabled==="YES"&&f.salesTaxUSEnabled),N={estimate_date:{required:g.withMessage(m("validation.required"),w)},estimate_number:{required:g.withMessage(m("validation.required"),w)},reference_number:{maxLength:g.withMessage(m("validation.price_maxlength"),W(255))},customer_id:{required:g.withMessage(m("validation.required"),w)},exchange_rate:{required:ee(function(){return g.withMessage(m("validation.required"),w),e.showExchangeRate}),decimal:g.withMessage(m("validation.valid_exchange_rate"),J)}},y=X(N,E(()=>e.newEstimate),{$scope:k});V(()=>e.newEstimate.customer,a=>{a&&a.currency?e.newEstimate.selectedCurrency=a.currency:e.newEstimate.selectedCurrency=r.selectedCompanyCurrency}),e.resetCurrentEstimate(),B.resetCustomFields(),y.value.$reset,e.fetchEstimateInitialSettings(_.value),V(()=>{var a;return(a=r.selectedCompanySettings)==null?void 0:a.tax_included_by_default},a=>{e.newEstimate.tax_included=a==="YES"},{immediate:!0});async function j(){if(y.value.$touch(),y.value.$invalid)return!1;u.value=!0;let a=oe.cloneDeep({...e.newEstimate,sub_total:e.getSubTotal,total:e.getTotal,tax:e.getTotalTax});a.discount_per_item==="YES"?a.items.forEach((n,S)=>{n.discount_type==="fixed"&&(a.items[S].discount=Math.round(n.discount*100))}):a.discount_type==="fixed"&&(a.discount=Math.round(a.discount*100)),!e.newEstimate.tax_per_item==="YES"&&a.taxes.length&&(a.tax_type_ids=a.taxes.map(n=>n.tax_type_id));const q=_.value?e.updateEstimate:e.addEstimate;try{let n=await q(a);n.data.data&&F.push(`/admin/estimates/${n.data.data.id}/view`)}catch(n){console.error(n)}u.value=!1}return(a,q)=>{const n=l("BaseBreadcrumbItem"),S=l("BaseBreadcrumb"),I=l("BaseButton"),U=l("router-link"),G=l("BaseIcon"),Y=l("BasePageHeader"),R=l("BaseScrollPane"),A=l("BasePage");return c(),P(Z,null,[s(re),s(me),s(fe),D.value&&(!t(p)||t(d).query.customer)?(c(),v(le,{key:0,store:t(e),"store-prop":"newEstimate","is-edit":t(_),customer:t(e).newEstimate.customer},null,8,["store","is-edit","customer"])):C("",!0),s(A,{class:"relative estimate-create-page"},{default:o(()=>[b("form",{onSubmit:se(j,["prevent"])},[s(Y,{title:t(T)},{actions:o(()=>[a.$route.name==="estimates.edit"?(c(),v(U,{key:0,to:`/estimates/pdf/${t(e).newEstimate.unique_hash}`,target:"_blank"},{default:o(()=>[s(I,{class:"mr-3",variant:"primary-outline",type:"button"},{default:o(()=>[b("span",ye,L(a.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):C("",!0),s(I,{loading:t(u),disabled:t(u),"content-loading":t(p),variant:"primary",type:"submit"},{left:o(H=>[t(u)?C("",!0):(c(),v(G,{key:0,class:ne(H.class),name:"ArrowDownOnSquareIcon"},null,8,["class"]))]),default:o(()=>[ie(" "+L(a.$t("estimates.save_estimate")),1)]),_:1},8,["loading","disabled","content-loading"])]),default:o(()=>[s(S,null,{default:o(()=>[s(n,{title:a.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),s(n,{title:a.$t("estimates.estimate",2),to:"/admin/estimates"},null,8,["title"]),a.$route.name==="estimates.edit"?(c(),v(n,{key:0,title:a.$t("estimates.edit_estimate"),to:"#",active:""},null,8,["title"])):(c(),v(n,{key:1,title:a.$t("estimates.new_estimate"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),s(ve,{v:t(y),"is-loading":t(p),"is-edit":t(_)},null,8,["v","is-loading","is-edit"]),s(R,null,{default:o(()=>[s(de,{currency:t(e).newEstimate.selectedCurrency,"is-loading":t(p),"item-validation-scope":k,store:t(e),"store-prop":"newEstimate"},null,8,["currency","is-loading","store"]),b("div",we,[b("div",be,[s(ue,{store:t(e),"store-prop":"newEstimate",fields:h.value,type:"Estimate"},null,8,["store","fields"]),s(_e,{type:"Estimate","is-edit":t(_),"is-loading":t(p),store:t(e),"store-prop":"newEstimate","custom-field-scope":k,class:"mb-6"},null,8,["is-edit","is-loading","store"]),s(ce,{store:t(e),"component-name":"EstimateTemplate","store-prop":"newEstimate","is-mark-as-default":$.value},null,8,["store","is-mark-as-default"])]),s(pe,{currency:t(e).newEstimate.selectedCurrency,"is-loading":t(p),store:t(e),"store-prop":"newEstimate","tax-popup-type":"estimate"},null,8,["currency","is-loading","store"])])]),_:1})],32)]),_:1})],64)}}};export{Le as default};
