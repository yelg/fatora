import{G as re,ar as ie,O as de,a9 as ue,v as ce,e as _,I as me,j as S,P as ve,S as fe,c as w,a,K as v,L as f,w as o,Q as j,N as pe,r,o as i,b as d,l as g,V as A,q as C,t as y,R as _e,M as ye}from"./main-DnObvGgc.js";import{_ as be}from"./SendInvoiceModal-CdKzIyKq.js";import{_ as ge}from"./InvoiceIndexDropdown-CqloNa6W.js";import{L as he}from"./LoadingIcon-UlwLbdlO.js";import"./mail-driver-DqYWSwW8.js";const Be={class:"text-sm mr-3"},xe={class:"fixed top-0 left-0 hidden h-full pt-16 pb-[6.4rem] ml-56 bg-white xl:ml-64 w-88 xl:block"},Ie={class:"flex items-center justify-between px-4 pt-8 pb-2 border border-gray-200 border-solid height-full"},ke={class:"mb-6"},Se={class:"flex mb-6 ml-3",role:"group","aria-label":"First group"},we={class:"px-2 py-1 pb-2 mb-1 mb-2 text-sm border-b border-gray-200 border-solid"},Te={class:"flex-2"},Ve={class:"mt-1 mb-2 text-xs not-italic font-medium leading-5 text-gray-600"},Ee={class:"flex-1 whitespace-nowrap right"},Fe={class:"text-sm not-italic font-normal leading-5 text-right text-gray-600 est-date"},$e={key:0,class:"flex justify-center p-4 items-center"},De={key:1,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},Ne={class:"flex flex-col min-h-0 mt-8 overflow-hidden",style:{height:"75vh"}},Le=["src"],je={__name:"View",setup(Ae){const R=re(),E=ie(),F=de(),O=ue(),{t:p}=ce.useI18n(),l=_(null),h=pe(),T=_(!1),B=_(!1),u=_(null),x=_(1),$=_(1),M=_(null),t=me({orderBy:null,orderByField:null,searchText:null}),G=S(()=>l.value.invoice_number),z=S(()=>t.orderBy==="asc"||t.orderBy==null);S(()=>z.value?p("general.ascending"):p("general.descending"));const H=S(()=>`/invoices/pdf/${l.value.unique_hash}`);S(()=>l.value&&l.value.id?invoice.value.id:null),ve(h,(e,n)=>{e.name==="invoices.view"&&P()});async function q(){O.openDialog({title:p("general.are_you_sure"),message:p("invoices.invoice_mark_as_sent"),yesLabel:p("general.ok"),noLabel:p("general.cancel"),variant:"primary",hideNoButton:!1,size:"lg"}).then(async e=>{T.value=!1,e&&(await E.markAsSent({id:l.value.id,status:"SENT"}),l.value.status="SENT",T.value=!0),T.value=!1})}async function K(e){R.openModal({title:p("invoices.send_invoice"),componentName:"SendInvoiceModal",id:l.value.id,data:l.value})}function Q(e){return h.params.id==e}async function I(e,n=!1){if(B.value)return;let c={};t.searchText!==""&&t.searchText!==null&&t.searchText!==void 0&&(c.search=t.searchText),t.orderBy!==null&&t.orderBy!==void 0&&(c.orderBy=t.orderBy),t.orderByField!==null&&t.orderByField!==void 0&&(c.orderByField=t.orderByField),B.value=!0;let k=await E.fetchInvoices({page:e,...c});B.value=!1,u.value=u.value?u.value:[],u.value=[...u.value,...k.data.data],x.value=e||1,$.value=k.data.meta.last_page;let V=u.value.find(b=>b.id==h.params.id);n==!1&&!V&&x.value<$.value&&Object.keys(c).length===0&&I(++x.value),V&&setTimeout(()=>{n==!1&&W()},500)}function W(){const e=document.getElementById(`invoice-${h.params.id}`);e&&(e.scrollIntoView({behavior:"smooth"}),e.classList.add("shake"),Y())}function Y(){M.value.addEventListener("scroll",e=>{e.target.scrollTop>0&&e.target.scrollTop+e.target.clientHeight>e.target.scrollHeight-200&&x.value<$.value&&I(++x.value,!0)})}async function P(){let e=await E.fetchInvoice(h.params.id);e.data&&(l.value={...e.data.data})}async function m(){u.value=[],I()}function J(){return t.orderBy==="asc"?(t.orderBy="desc",m(),!0):(t.orderBy="asc",m(),!0)}function X(){let e=u.value.findIndex(n=>n.id===l.value.id);u.value[e]&&(u.value[e].status="SENT",l.value.status="SENT")}return I(),P(),m=fe.debounce(m,500),(e,n)=>{const c=r("BaseButton"),k=r("router-link"),V=r("BasePageHeader"),b=r("BaseIcon"),Z=r("BaseInput"),D=r("BaseRadio"),N=r("BaseInputGroup"),L=r("BaseDropdownItem"),ee=r("BaseDropdown"),te=r("BaseText"),ae=r("BaseInvoiceStatusLabel"),se=r("BaseEstimateStatusBadge"),oe=r("BaseFormatMoney"),le=r("BasePage");return i(),w(j,null,[a(be,{onUpdate:X}),l.value?(i(),v(le,{key:0,class:"xl:pl-96 xl:ml-8"},{default:o(()=>{var U;return[a(V,{title:G.value},{actions:o(()=>[d("div",Be,[l.value.status==="DRAFT"&&g(F).hasAbilities(g(A).EDIT_INVOICE)?(i(),v(c,{key:0,disabled:T.value,variant:"primary-outline",onClick:q},{default:o(()=>[C(y(e.$t("invoices.mark_as_sent")),1)]),_:1},8,["disabled"])):f("",!0)]),l.value.status==="DRAFT"&&g(F).hasAbilities(g(A).SEND_INVOICE)?(i(),v(c,{key:0,variant:"primary",class:"text-sm",onClick:K},{default:o(()=>[C(y(e.$t("invoices.send_invoice")),1)]),_:1})):f("",!0),g(F).hasAbilities(g(A).CREATE_PAYMENT)?(i(),v(k,{key:1,to:`/admin/payments/${e.$route.params.id}/create`},{default:o(()=>[l.value.status==="SENT"||l.value.status==="VIEWED"?(i(),v(c,{key:0,variant:"primary"},{default:o(()=>[C(y(e.$t("invoices.record_payment")),1)]),_:1})):f("",!0)]),_:1},8,["to"])):f("",!0),a(ge,{class:"ml-3",row:l.value,"load-data":I},null,8,["row"])]),_:1},8,["title"]),d("div",xe,[d("div",Ie,[d("div",ke,[a(Z,{modelValue:t.searchText,"onUpdate:modelValue":n[0]||(n[0]=s=>t.searchText=s),placeholder:e.$t("general.search"),type:"text",variant:"gray",onInput:n[1]||(n[1]=s=>m())},{right:o(()=>[a(b,{name:"MagnifyingGlassIcon",class:"h-5 text-gray-400"})]),_:1},8,["modelValue","placeholder"])]),d("div",Se,[a(ee,{class:"ml-3",position:"bottom-start"},{activator:o(()=>[a(c,{size:"md",variant:"gray"},{default:o(()=>[a(b,{name:"FunnelIcon"})]),_:1})]),default:o(()=>[d("div",we,y(e.$t("general.sort_by")),1),a(L,{class:"flex px-1 py-2 cursor-pointer"},{default:o(()=>[a(N,{class:"-mt-3 font-normal"},{default:o(()=>[a(D,{id:"filter_invoice_date",modelValue:t.orderByField,"onUpdate:modelValue":[n[2]||(n[2]=s=>t.orderByField=s),m],label:e.$t("reports.invoices.invoice_date"),size:"sm",name:"filter",value:"invoice_date"},null,8,["modelValue","label"])]),_:1})]),_:1}),a(L,{class:"flex px-1 py-2 cursor-pointer"},{default:o(()=>[a(N,{class:"-mt-3 font-normal"},{default:o(()=>[a(D,{id:"filter_due_date",modelValue:t.orderByField,"onUpdate:modelValue":[n[3]||(n[3]=s=>t.orderByField=s),m],label:e.$t("invoices.due_date"),value:"due_date",size:"sm",name:"filter"},null,8,["modelValue","label"])]),_:1})]),_:1}),a(L,{class:"flex px-1 py-2 cursor-pointer"},{default:o(()=>[a(N,{class:"-mt-3 font-normal"},{default:o(()=>[a(D,{id:"filter_invoice_number",modelValue:t.orderByField,"onUpdate:modelValue":[n[4]||(n[4]=s=>t.orderByField=s),m],label:e.$t("invoices.invoice_number"),value:"invoice_number",size:"sm",name:"filter"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),a(c,{class:"ml-1",size:"md",variant:"gray",onClick:J},{default:o(()=>[z.value?(i(),v(b,{key:0,name:"BarsArrowUpIcon"})):(i(),v(b,{key:1,name:"BarsArrowDownIcon"}))]),_:1})])]),d("div",{ref_key:"invoiceListSection",ref:M,class:"h-full overflow-y-scroll border-l border-gray-200 border-solid base-scroll"},[(i(!0),w(j,null,_e(u.value,(s,ne)=>(i(),w("div",{key:ne},[s?(i(),v(k,{key:0,id:"invoice-"+s.id,to:`/admin/invoices/${s.id}/view`,class:ye(["flex justify-between side-invoice p-4 cursor-pointer hover:bg-gray-100 items-center border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":Q(s.id)}]),style:{"border-bottom":"1px solid rgba(185, 193, 209, 0.41)"}},{default:o(()=>[d("div",Te,[a(te,{text:s.customer.name,class:"pr-2 mb-2 text-sm not-italic font-normal leading-5 text-black capitalize truncate"},null,8,["text"]),d("div",Ve,y(s.invoice_number),1),a(se,{status:s.status,class:"px-1 text-xs"},{default:o(()=>[a(ae,{status:s.status},null,8,["status"])]),_:2},1032,["status"])]),d("div",Ee,[a(oe,{class:"mb-2 text-xl not-italic font-semibold leading-8 text-right text-gray-900 block",amount:s.total,currency:s.customer.currency},null,8,["amount","currency"]),d("div",Fe,y(s.formatted_invoice_date),1)])]),_:2},1032,["id","to","class"])):f("",!0)]))),128)),B.value?(i(),w("div",$e,[a(he,{class:"h-6 m-1 animate-spin text-primary-400"})])):f("",!0),!((U=u.value)!=null&&U.length)&&!B.value?(i(),w("p",De,y(e.$t("invoices.no_matching_invoices")),1)):f("",!0)],512)]),d("div",Ne,[d("iframe",{src:`${H.value}`,class:"flex-1 border border-gray-400 border-solid bg-white rounded-md frame-style"},null,8,Le)])]}),_:1})):f("",!0)],64)}}};export{je as default};
