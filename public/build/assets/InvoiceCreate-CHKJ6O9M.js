import{ar as F,F as P,j as _,r as l,c as M,o as p,a as o,l as t,w as s,ag as z,aw as K,aB as Q,v as J,e as k,f as I,$ as W,g as $,ah as X,i as Z,P as L,K as w,L as q,Q as ee,aj as te,N as ne,n as oe,b as B,m as ie,t as T,q as ae,M as se,S as le}from"./main-DnObvGgc.js";import{_ as ce,a as re,b as ue,c as de,d as me,e as ve,f as pe}from"./SalesTax-CYrASWLJ.js";import{_ as _e}from"./ExchangeRateConverter-Bb7rrT2I.js";import{_ as ge}from"./CreateCustomFields-CBKwtRG5.js";import{_ as fe}from"./TaxTypeModal-Byuj8aRW.js";import"./DragIcon-DZ4DjgJ9.js";import"./SelectNotePopup-D_ZaygaK.js";import"./NoteModal-Dr6YmiAY.js";import"./payment-COlo_rP3.js";import"./exchange-rate-C4tOL1sk.js";const Ie={class:"grid grid-cols-12 gap-8 mt-6 mb-8"},ye={__name:"InvoiceCreateBasicFields",props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(i){const e=F(),g=P(),S=_(()=>g.selectedCompanySettings.invoice_use_time==="YES"),h=_(()=>g.selectedCompanySettings.carbon_time_format.indexOf("H")>-1);return(c,a)=>{const C=l("BaseCustomerSelectPopup"),u=l("BaseDatePicker"),y=l("BaseInputGroup"),x=l("BaseInput"),v=l("BaseInputGrid");return p(),M("div",Ie,[o(C,{modelValue:t(e).newInvoice.customer,"onUpdate:modelValue":a[0]||(a[0]=r=>t(e).newInvoice.customer=r),valid:i.v.customer_id,"content-loading":i.isLoading,type:"invoice",class:"col-span-12 lg:col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"]),o(v,{class:"col-span-12 lg:col-span-7"},{default:s(()=>[o(y,{label:c.$t("invoices.invoice_date"),"content-loading":i.isLoading,required:"",error:i.v.invoice_date.$error&&i.v.invoice_date.$errors[0].$message},{default:s(()=>[o(u,{modelValue:t(e).newInvoice.invoice_date,"onUpdate:modelValue":a[1]||(a[1]=r=>t(e).newInvoice.invoice_date=r),"content-loading":i.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar",enableTime:S.value,time24hr:h.value},null,8,["modelValue","content-loading","enableTime","time24hr"])]),_:1},8,["label","content-loading","error"]),o(y,{label:c.$t("invoices.due_date"),"content-loading":i.isLoading},{default:s(()=>[o(u,{modelValue:t(e).newInvoice.due_date,"onUpdate:modelValue":a[2]||(a[2]=r=>t(e).newInvoice.due_date=r),"content-loading":i.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),o(y,{label:c.$t("invoices.invoice_number"),"content-loading":i.isLoading,error:i.v.invoice_number.$error&&i.v.invoice_number.$errors[0].$message,required:""},{default:s(()=>[o(x,{modelValue:t(e).newInvoice.invoice_number,"onUpdate:modelValue":a[3]||(a[3]=r=>t(e).newInvoice.invoice_number=r),"content-loading":i.isLoading,onInput:a[4]||(a[4]=r=>i.v.invoice_number.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),o(_e,{store:t(e),"store-prop":"newInvoice",v:i.v,"is-loading":i.isLoading,"is-edit":i.isEdit,"customer-currency":t(e).newInvoice.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1})])}}},be={class:"flex"},we={class:"block mt-10 invoice-foot lg:flex lg:justify-between lg:items-start"},$e={class:"relative w-full lg:w-1/2 lg:mr-4"},V="newInvoice",Te={__name:"InvoiceCreate",setup(i){const e=F(),g=P(),S=z(),h=K();Q();const{t:c}=J.useI18n();let a=ne(),C=oe(),u=k(!1);const y=k(!1),x=k(["customer","company","customerCustom","invoice","invoiceCustom"]);let v=_(()=>e.isFetchingInvoice||e.isFetchingInitialSettings),r=_(()=>f.value?c("invoices.edit_invoice"):c("invoices.new_invoice"));const N=_(()=>g.selectedCompanySettings.sales_tax_us_enabled==="YES"&&h.salesTaxUSEnabled);let f=_(()=>a.name==="invoices.edit");const D={invoice_date:{required:I.withMessage(c("validation.required"),$)},reference_number:{maxLength:I.withMessage(c("validation.price_maxlength"),X(255))},customer_id:{required:I.withMessage(c("validation.required"),$)},invoice_number:{required:I.withMessage(c("validation.required"),$)},exchange_rate:{required:te(function(){return I.withMessage(c("validation.required"),$),e.showExchangeRate}),decimal:I.withMessage(c("validation.valid_exchange_rate"),W)}},b=Z(D,_(()=>e.newInvoice),{$scope:V});S.resetCustomFields(),b.value.$reset,e.resetCurrentInvoice(),e.fetchInvoiceInitialSettings(f.value),L(()=>e.newInvoice.customer,n=>{n&&n.currency?e.newInvoice.selectedCurrency=n.currency:e.newInvoice.selectedCurrency=g.selectedCompanyCurrency}),L(()=>{var n;return(n=g.selectedCompanySettings)==null?void 0:n.tax_included_by_default},n=>{e.newInvoice.tax_included=n==="YES"},{immediate:!0});async function j(){if(b.value.$touch(),b.value.$invalid)return console.log("Form is invalid:",b.value.$errors),!1;u.value=!0;let n=le.cloneDeep({...e.newInvoice,sub_total:e.getSubTotal,total:e.getTotal,tax:e.getTotalTax});n.discount_per_item==="YES"?n.items.forEach((d,m)=>{d.discount_type==="fixed"&&(n.items[m].discount=d.discount*100)}):n.discount_type==="fixed"&&(n.discount=n.discount*100),!e.newInvoice.tax_per_item==="YES"&&n.taxes.length&&(n.tax_type_ids=n.taxes.map(d=>d.tax_type_id));try{const m=await(f.value?e.updateInvoice:e.addInvoice)(n);C.push(`/admin/invoices/${m.data.data.id}/view`)}catch(d){console.error(d)}u.value=!1}return(n,d)=>{const m=l("BaseBreadcrumbItem"),U=l("BaseBreadcrumb"),E=l("BaseButton"),Y=l("router-link"),G=l("BaseIcon"),H=l("BasePageHeader"),O=l("BaseScrollPane"),R=l("BasePage");return p(),M(ee,null,[o(re),o(ue),o(fe),N.value&&(!t(v)||t(a).query.customer)?(p(),w(ce,{key:0,store:t(e),"is-edit":t(f),"store-prop":"newInvoice",customer:t(e).newInvoice.customer},null,8,["store","is-edit","customer"])):q("",!0),o(R,{class:"relative invoice-create-page"},{default:s(()=>[B("form",{onSubmit:ie(j,["prevent"])},[o(H,{title:t(r)},{actions:s(()=>[n.$route.name==="invoices.edit"?(p(),w(Y,{key:0,to:`/invoices/pdf/${t(e).newInvoice.unique_hash}`,target:"_blank"},{default:s(()=>[o(E,{class:"mr-3",variant:"primary-outline",type:"button"},{default:s(()=>[B("span",be,T(n.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):q("",!0),o(E,{loading:t(u),disabled:t(u),variant:"primary",type:"submit"},{left:s(A=>[t(u)?q("",!0):(p(),w(G,{key:0,name:"ArrowDownOnSquareIcon",class:se(A.class)},null,8,["class"]))]),default:s(()=>[ae(" "+T(n.$t("invoices.save_invoice")),1)]),_:1},8,["loading","disabled"])]),default:s(()=>[o(U,null,{default:s(()=>[o(m,{title:n.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),o(m,{title:n.$t("invoices.invoice",2),to:"/admin/invoices"},null,8,["title"]),n.$route.name==="invoices.edit"?(p(),w(m,{key:0,title:n.$t("invoices.edit_invoice"),to:"#",active:""},null,8,["title"])):(p(),w(m,{key:1,title:n.$t("invoices.new_invoice"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),o(ye,{v:t(b),"is-loading":t(v),"is-edit":t(f)},null,8,["v","is-loading","is-edit"]),o(O,null,{default:s(()=>[o(de,{currency:t(e).newInvoice.selectedCurrency,"is-loading":t(v),"item-validation-scope":V,store:t(e),"store-prop":"newInvoice"},null,8,["currency","is-loading","store"]),B("div",we,[B("div",$e,[o(me,{store:t(e),"store-prop":"newInvoice",fields:x.value,type:"Invoice"},null,8,["store","fields"]),o(ge,{type:"Invoice","is-edit":t(f),"is-loading":t(v),store:t(e),"store-prop":"newInvoice","custom-field-scope":V,class:"mb-6"},null,8,["is-edit","is-loading","store"]),o(ve,{store:t(e),"store-prop":"newInvoice","component-name":"InvoiceTemplate","is-mark-as-default":y.value},null,8,["store","is-mark-as-default"])]),o(pe,{currency:t(e).newInvoice.selectedCurrency,"is-loading":t(v),store:t(e),"store-prop":"newInvoice","tax-popup-type":"invoice"},null,8,["currency","is-loading","store"])])]),_:1})],32)]),_:1})],64)}}};export{Te as default};
