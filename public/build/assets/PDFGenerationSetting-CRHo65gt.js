import{s as C,u as L,a3 as V,v as z,j as y,f as $,g as B,i as O,k as j,r as g,c as M,o as m,a as l,b as P,w as u,l as t,a4 as A,q as U,t as x,K as I,L as G,M as E,m as K,e as F,a5 as T}from"./main-DnObvGgc.js";const{defineStore:H}=window.pinia,k=(i=!1)=>{const b=i?window.pinia.defineStore:H,{global:d}=window.i18n;return b({id:"pdf-driver",state:()=>({pdfDriverConfig:null,pdf_driver:"dompdf",pdf_drivers:[],dompdf:{pdf_driver:""},gotenberg:{pdf_driver:"",gotenberg_host:"",gotenberg_papersize:""}}),actions:{async fetchDrivers(){try{const n=await C.get("/api/v1/pdf/drivers");this.pdf_drivers=n.data}catch(n){throw V(n),n}},async fetchConfig(){try{const n=await C.get("/api/v1/pdf/config");this.pdfDriverConfig=n.data,this.pdf_driver=n.data.pdf_driver}catch(n){throw V(n),n}},async updateConfig(n){try{const e=await C.post("/api/v1/pdf/config",n),s=L();e.data.success?s.showNotification({type:"success",message:d.t("settings.pdf."+e.data.success)}):s.showNotification({type:"error",message:d.t("settings.pdf."+e.data.error)})}catch(e){throw V(e),e}}}})()},J={class:"flex my-10"},Q={__name:"GotenbergDriver",props:{configData:{type:Object,require:!0,default:Object},isSaving:{type:Boolean,require:!0,default:!1},isFetchingInitialData:{type:Boolean,require:!0,default:!1},drivers:{type:Array,require:!0,default:Array}},emits:["submit-data","on-change-driver"],setup(i,{emit:b}){const d=i,n=b,e=k(),{t:s}=z.useI18n(),h=y(()=>({gotenberg:{pdf_driver:{required:$.withMessage(s("validation.required"),B)},gotenberg_host:{required:$.withMessage(s("validation.required"),B)},gotenberg_papersize:{required:$.withMessage(s("validation.required"),B)}}})),o=O(h,y(()=>e));function f(){o.value.gotenberg.pdf_driver.$touch(),n("on-change-driver",e.gotenberg.pdf_driver)}async function _(){return o.value.gotenberg.$touch(),o.value.gotenberg.$invalid||n("submit-data",e.gotenberg),!1}return j(()=>{for(const r in e.gotenberg)d.configData.hasOwnProperty(r)&&e.$patch(a=>{a.gotenberg[r]=d.configData[r]});e.gotenberg.gotenberg_papersize==""&&e.$patch(r=>{r.gotenberg.gotenberg_papersize="210mm 297mm"})}),(r,a)=>{const p=g("BaseMultiselect"),v=g("BaseInputGroup"),D=g("BaseInput"),S=g("BaseInputGrid"),w=g("BaseIcon"),q=g("BaseButton");return m(),M("form",{onSubmit:K(_,["prevent"])},[l(S,null,{default:u(()=>[l(v,{label:r.$t("settings.pdf.driver"),error:t(o).gotenberg.pdf_driver.$error&&t(o).gotenberg.pdf_driver.$errors[0].$message,required:""},{default:u(()=>[l(p,{modelValue:t(e).gotenberg.pdf_driver,"onUpdate:modelValue":[a[0]||(a[0]=c=>t(e).gotenberg.pdf_driver=c),f],"content-loading":i.isFetchingInitialData,options:i.drivers,"can-deselect":!1,invalid:t(o).gotenberg.pdf_driver.$error},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","error"]),l(v,{label:r.$t("settings.pdf.gotenberg_host"),"content-loading":i.isFetchingInitialData,error:t(o).gotenberg.gotenberg_host.$error&&t(o).gotenberg.gotenberg_host.$errors[0].$message,required:""},{default:u(()=>[l(D,{modelValue:t(e).gotenberg.gotenberg_host,"onUpdate:modelValue":a[1]||(a[1]=c=>t(e).gotenberg.gotenberg_host=c),"content-loading":i.isFetchingInitialData,invalid:t(o).gotenberg.gotenberg_host.$error,type:"text",name:"gotenberg_host"},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),l(v,{label:r.$t("settings.pdf.papersize"),"content-loading":i.isFetchingInitialData,error:t(o).gotenberg.gotenberg_papersize.$error&&t(o).gotenberg.gotenberg_papersize.$errors[0].$message,"help-text":r.$t("settings.pdf.papersize_hint"),required:""},{default:u(()=>[l(D,{modelValue:t(e).gotenberg.gotenberg_papersize,"onUpdate:modelValue":a[2]||(a[2]=c=>t(e).gotenberg.gotenberg_papersize=c),"content-loading":i.isFetchingInitialData,invalid:t(o).gotenberg.gotenberg_papersize.$error,type:"text",name:"gotenberg_papersize"},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error","help-text"])]),_:1}),P("div",J,[l(q,{disabled:i.isSaving,"content-loading":i.isFetchingInitialData,loading:i.isSaving,type:"submit",variant:"primary"},{left:u(c=>[i.isSaving?G("",!0):(m(),I(w,{key:0,name:"SaveIcon",class:E(c.class)},null,8,["class"]))]),default:u(()=>[U(" "+x(r.$t("general.save")),1)]),_:1},8,["disabled","content-loading","loading"]),A(r.$slots,"default")])],32)}}},R={class:"flex my-10"},N={__name:"DomPDFDriver",props:{configData:{type:Object,require:!0,default:Object},isSaving:{type:Boolean,require:!0,default:!1},isFetchingInitialData:{type:Boolean,require:!0,default:!1},drivers:{type:Array,require:!0,default:Array}},emits:["submit-data","on-change-driver"],setup(i,{emit:b}){const d=i,n=b;let e=F(!1);const s=k(),{t:h}=z.useI18n(),o=y(()=>({dompdf:{pdf_driver:{required:$.withMessage(h("validation.required"),B)}}})),f=O(o,y(()=>s));function _(){f.value.dompdf.pdf_driver.$touch(),n("on-change-driver",s.dompdf.pdf_driver)}async function r(){return f.value.dompdf.$touch(),f.value.dompdf.$invalid||n("submit-data",s.dompdf),!1}return j(()=>{for(const a in s.dompdf)d.configData.hasOwnProperty(a)&&s.$patch(p=>{p.dompdf[a]=d.configData[a]})}),(a,p)=>{const v=g("BaseMultiselect"),D=g("BaseInputGroup"),S=g("BaseInputGrid"),w=g("BaseIcon"),q=g("BaseButton");return m(),M("form",{onSubmit:K(r,["prevent"])},[l(S,null,{default:u(()=>[l(D,{label:a.$t("settings.pdf.driver"),error:t(f).dompdf.pdf_driver.$error&&t(f).dompdf.pdf_driver.$errors[0].$message,required:""},{default:u(()=>[l(v,{modelValue:t(s).dompdf.pdf_driver,"onUpdate:modelValue":[p[0]||(p[0]=c=>t(s).dompdf.pdf_driver=c),_],"content-loading":t(e),options:i.drivers,"can-deselect":!1,invalid:t(f).dompdf.pdf_driver.$error},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","error"])]),_:1}),P("div",R,[l(q,{disabled:i.isSaving,"content-loading":t(e),loading:i.isSaving,type:"submit",variant:"primary"},{left:u(c=>[i.isSaving?G("",!0):(m(),I(w,{key:0,name:"SaveIcon",class:E(c.class)},null,8,["class"]))]),default:u(()=>[U(" "+x(a.$t("general.save")),1)]),_:1},8,["disabled","content-loading","loading"]),A(a.$slots,"default")])],32)}}},W={key:0,class:"mt-14"},Y={__name:"PDFGenerationSetting",emits:["submit-data","on-change-driver"],setup(i,{emit:b}){let d=F(!1),n=F(!1);const e=k(),{t:s}=z.useI18n();function h(r){e.pdf_driver=r,e.pdfDriverConfig.pdf_driver=r}async function o(){d.value=!0,await Promise.all([e.fetchDrivers(),e.fetchConfig()]),d.value=!1}o();async function f(r){try{n.value=!0,await e.updateConfig(r)}catch(a){console.error(a)}finally{return n.value=!1,!1}}const _=y(()=>{switch(e.pdf_driver){case"dompdf":return N;case"gotenberg":return Q;default:return N}});return(r,a)=>{const p=g("BaseSettingCard");return m(),I(p,{title:r.$t("settings.pdf.pdf_configuration"),description:r.$t("settings.pdf.section_description")},{default:u(()=>[t(e)&&t(e).pdfDriverConfig?(m(),M("div",W,[(m(),I(T(_.value),{"config-data":t(e).pdfDriverConfig,"is-saving":t(n),drivers:t(e).pdf_drivers,"is-fetching-initial-data":t(d),onOnChangeDriver:a[0]||(a[0]=v=>h(v)),onSubmitData:f},null,40,["config-data","is-saving","drivers","is-fetching-initial-data"]))])):G("",!0)]),_:1},8,["title","description"])}}};export{Y as default};
