import{aa as N,N as O,v as U,e as P,I as M,S as ee,j as E,r as u,c as B,o as a,b as i,a as e,w as o,l,t as _,K as d,L as p,Q as G,R as q,M as X,q as V,a0 as te,F as se,a7 as K,P as ae,p as le,a9 as ne,O as oe,n as re,V as D}from"./main-DnObvGgc.js";import{L as ie}from"./LoadingIcon-UlwLbdlO.js";import{_ as ce}from"./LineChart-DP-Txe3I.js";import{_ as ue}from"./CustomerIndexDropdown-BaDQuLpc.js";const de={class:"fixed top-0 left-0 hidden h-full pt-16 pb-[6.6rem] ml-56 bg-white xl:ml-64 w-88 xl:block"},me={class:"flex items-center justify-between px-4 pt-8 pb-2 border border-gray-200 border-solid height-full"},pe={class:"flex mb-6 ml-3",role:"group","aria-label":"First group"},_e={class:"px-4 py-3 pb-2 mb-2 text-sm border-b border-gray-200 border-solid"},fe={class:"px-2"},ye={class:"px-2"},he={class:"flex-1 font-bold text-right whitespace-nowrap"},ge={key:0,class:"flex justify-center p-4 items-center"},ve={key:1,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},be={__name:"CustomerViewSidebar",setup(L){const $=N(),t=O(),{t:f}=U.useI18n();let y=P(!1),s=M({orderBy:null,orderByField:null,searchText:null});const r=P(null),x=P(1),h=P(1),w=P(null);g=ee.debounce(g,500);const A=E(()=>s.orderBy==="asc"||s.orderBy==null);E(()=>A.value?f("general.ascending"):f("general.descending"));function m(n){return t.params.id==n}async function C(n,c=!1){if(y.value)return;let v={};s.searchText!==""&&s.searchText!==null&&s.searchText!==void 0&&(v.display_name=s.searchText),s.orderBy!==null&&s.orderBy!==void 0&&(v.orderBy=s.orderBy),s.orderByField!==null&&s.orderByField!==void 0&&(v.orderByField=s.orderByField),y.value=!0;let F=await $.fetchCustomers({page:n,...v,limit:15});y.value=!1,r.value=r.value?r.value:[],r.value=[...r.value,...F.data.data],x.value=n||1,h.value=F.data.meta.last_page;let S=r.value.find(j=>j.id==t.params.id);c==!1&&!S&&x.value<h.value&&Object.keys(v).length===0&&C(++x.value),S&&setTimeout(()=>{c==!1&&k()},500)}function k(){const n=document.getElementById(`customer-${t.params.id}`);n&&(n.scrollIntoView({behavior:"smooth"}),n.classList.add("shake"),T())}function T(){w.value.addEventListener("scroll",n=>{n.target.scrollTop>0&&n.target.scrollTop+n.target.clientHeight>n.target.scrollHeight-200&&x.value<h.value&&C(++x.value,!0)})}async function g(){r.value=[],C()}function I(){return s.orderBy==="asc"?(s.orderBy="desc",g(),!0):(s.orderBy="asc",g(),!0)}return C(),(n,c)=>{var Y;const v=u("BaseIcon"),F=u("BaseInput"),S=u("BaseButton"),j=u("BaseRadio"),R=u("BaseInputGroup"),z=u("BaseDropdownItem"),Q=u("BaseDropdown"),H=u("BaseText"),J=u("BaseFormatMoney"),W=u("router-link");return a(),B("div",de,[i("div",me,[e(F,{modelValue:l(s).searchText,"onUpdate:modelValue":c[0]||(c[0]=b=>l(s).searchText=b),placeholder:n.$t("general.search"),"container-class":"mb-6",type:"text",variant:"gray",onInput:c[1]||(c[1]=b=>g())},{default:o(()=>[e(v,{name:"MagnifyingGlassIcon",class:"text-gray-500"})]),_:1},8,["modelValue","placeholder"]),i("div",pe,[e(Q,{"close-on-select":!1,position:"bottom-start","width-class":"w-40","position-class":"left-0"},{activator:o(()=>[e(S,{variant:"gray"},{default:o(()=>[e(v,{name:"FunnelIcon"})]),_:1})]),default:o(()=>[i("div",_e,_(n.$t("general.sort_by")),1),i("div",fe,[e(z,{class:"flex px-1 py-2 mt-1 cursor-pointer hover:rounded-md"},{default:o(()=>[e(R,{class:"pt-2 -mt-4"},{default:o(()=>[e(j,{id:"filter_create_date",modelValue:l(s).orderByField,"onUpdate:modelValue":[c[2]||(c[2]=b=>l(s).orderByField=b),g],label:n.$t("customers.create_date"),size:"sm",name:"filter",value:"invoices.created_at"},null,8,["modelValue","label"])]),_:1})]),_:1})]),i("div",ye,[e(z,{class:"flex px-1 cursor-pointer hover:rounded-md"},{default:o(()=>[e(R,{class:"pt-2 -mt-4"},{default:o(()=>[e(j,{id:"filter_display_name",modelValue:l(s).orderByField,"onUpdate:modelValue":[c[3]||(c[3]=b=>l(s).orderByField=b),g],label:n.$t("customers.display_name"),size:"sm",name:"filter",value:"name"},null,8,["modelValue","label"])]),_:1})]),_:1})])]),_:1}),e(S,{class:"ml-1",size:"md",variant:"gray",onClick:I},{default:o(()=>[A.value?(a(),d(v,{key:0,name:"SortAscendingIcon"})):(a(),d(v,{key:1,name:"SortDescendingIcon"}))]),_:1})])]),i("div",{ref_key:"customerListSection",ref:w,class:"h-full overflow-y-scroll border-l border-gray-200 border-solid sidebar base-scroll"},[(a(!0),B(G,null,q(r.value,(b,Z)=>(a(),B("div",{key:Z},[b?(a(),d(W,{key:0,id:"customer-"+b.id,to:`/admin/customers/${b.id}/view`,class:X(["flex justify-between p-4 items-center cursor-pointer hover:bg-gray-100 border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":m(b.id)}]),style:{"border-top":"1px solid rgba(185, 193, 209, 0.41)"}},{default:o(()=>[i("div",null,[e(H,{text:b.name,class:"pr-2 text-sm not-italic font-normal leading-5 text-black capitalize truncate"},null,8,["text"]),b.contact_name?(a(),d(H,{key:0,text:b.contact_name,class:"mt-1 text-xs not-italic font-medium leading-5 text-gray-600"},null,8,["text"])):p("",!0)]),i("div",he,[e(J,{amount:b.due_amount!==null?b.due_amount:0,currency:b.currency},null,8,["amount","currency"])])]),_:2},1032,["id","to","class"])):p("",!0)]))),128)),l(y)?(a(),B("div",ge,[e(ie,{class:"h-6 m-1 animate-spin text-primary-400"})])):p("",!0),!((Y=r.value)!=null&&Y.length)&&!l(y)?(a(),B("p",ve,_(n.$t("customers.no_matching_customers")),1)):p("",!0)],512)])}}},xe={class:"pt-6 mt-5 border-t border-solid lg:pt-8 md:pt-4 border-gray-200"},Be={key:0,class:"text-sm font-bold leading-5 text-black non-italic"},$e={key:0},we={key:1},Ce={key:1,class:"text-sm font-bold leading-5 text-black non-italic"},ke={__name:"CustomerInfo",setup(L){const $=N(),t=E(()=>$.selectedViewCustomer),f=E(()=>$.isFetchingViewData),y=E(()=>{var s,r;return(s=t==null?void 0:t.value)!=null&&s.fields?(r=t==null?void 0:t.value)==null?void 0:r.fields:[]});return(s,r)=>{const x=u("BaseHeading"),h=u("BaseDescriptionListItem"),w=u("BaseDescriptionList"),A=u("BaseCustomerAddressDisplay");return a(),B("div",xe,[e(x,null,{default:o(()=>[V(_(s.$t("customers.basic_info")),1)]),_:1}),e(w,null,{default:o(()=>{var m,C,k;return[t.value.name?(a(),d(h,{key:0,"content-loading":f.value,label:s.$t("customers.display_name"),value:(m=t.value)==null?void 0:m.name},null,8,["content-loading","label","value"])):p("",!0),t.value.contact_name?(a(),d(h,{key:1,"content-loading":f.value,label:s.$t("customers.primary_contact_name"),value:(C=t.value)==null?void 0:C.contact_name},null,8,["content-loading","label","value"])):p("",!0),t.value.email?(a(),d(h,{key:2,"content-loading":f.value,label:s.$t("customers.email"),value:(k=t.value)==null?void 0:k.email},null,8,["content-loading","label","value"])):p("",!0)]}),_:1}),e(w,{class:"mt-5"},{default:o(()=>{var m,C,k,T,g,I,n;return[e(h,{"content-loading":f.value,label:s.$t("wizard.currency"),value:(m=t.value)!=null&&m.currency?`${(k=(C=t.value)==null?void 0:C.currency)==null?void 0:k.code} (${(g=(T=t.value)==null?void 0:T.currency)==null?void 0:g.symbol})`:""},null,8,["content-loading","label","value"]),t.value.phone?(a(),d(h,{key:0,"content-loading":f.value,label:s.$t("customers.phone_number"),value:(I=t.value)==null?void 0:I.phone},null,8,["content-loading","label","value"])):p("",!0),t.value.website?(a(),d(h,{key:1,"content-loading":f.value,label:s.$t("customers.website"),value:(n=t.value)==null?void 0:n.website},null,8,["content-loading","label","value"])):p("",!0)]}),_:1}),t.value.billing||t.value.shipping?(a(),d(x,{key:0,class:"mt-8"},{default:o(()=>[V(_(s.$t("customers.address")),1)]),_:1})):p("",!0),e(w,{class:"mt-5"},{default:o(()=>[t.value.billing?(a(),d(h,{key:0,"content-loading":f.value,label:s.$t("customers.billing_address")},{default:o(()=>[e(A,{address:t.value.billing},null,8,["address"])]),_:1},8,["content-loading","label"])):p("",!0),t.value.shipping?(a(),d(h,{key:1,"content-loading":f.value,label:s.$t("customers.shipping_address")},{default:o(()=>[e(A,{address:t.value.shipping},null,8,["address"])]),_:1},8,["content-loading","label"])):p("",!0)]),_:1}),y.value.length>0?(a(),d(x,{key:1,class:"mt-8"},{default:o(()=>[V(_(s.$t("settings.custom_fields.title")),1)]),_:1})):p("",!0),e(w,{class:"mt-5"},{default:o(()=>[(a(!0),B(G,null,q(y.value,(m,C)=>(a(),d(h,{key:C,"content-loading":f.value,label:m.custom_field.label},{default:o(()=>[m.type==="Switch"?(a(),B("p",Be,[m.default_answer===1?(a(),B("span",$e,_(s.$t("general.yes")),1)):(a(),B("span",we,_(s.$t("general.no")),1))])):(a(),B("p",Ce,_(m.default_answer),1))]),_:2},1032,["content-loading","label"]))),128))]),_:1})])}}},Te={},Ee={class:"col-span-12 xl:col-span-9 xxl:col-span-10"},Ie={class:"flex justify-between mt-1 mb-6"},De={class:"grid col-span-12 mt-6 text-center xl:mt-0 sm:grid-cols-4 xl:text-right xl:col-span-3 xl:grid-cols-1 xxl:col-span-2"},Se={class:"flex flex-col items-center justify-center px-6 py-2 lg:justify-end lg:items-end"},Ve={class:"flex flex-col items-center justify-center px-6 py-2 lg:justify-end lg:items-end"},Ae={class:"flex flex-col items-center justify-center px-6 py-2 lg:justify-end lg:items-end"},Pe={class:"flex flex-col items-center justify-center px-6 py-2 lg:justify-end lg:items-end"};function Fe(L,$){const t=u("BaseContentPlaceholdersText"),f=u("BaseContentPlaceholdersBox"),y=u("BaseContentPlaceholders");return a(),d(y,{class:"grid grid-cols-12"},{default:o(()=>[i("div",Ee,[i("div",Ie,[e(t,{class:"h-10 w-36",lines:1}),e(t,{class:"h-10 w-40 !mt-0",lines:1})]),e(f,{class:"h-80 xl:h-72 sm:w-full"})]),i("div",De,[i("div",Se,[e(t,{class:"h-3 w-14 xl:h-4",lines:1}),e(t,{class:"w-20 h-5 xl:h-6",lines:1})]),i("div",Ve,[e(t,{class:"h-3 w-14 xl:h-4",lines:1}),e(t,{class:"w-20 h-5 xl:h-6",lines:1})]),i("div",Ae,[e(t,{class:"h-3 w-14 xl:h-4",lines:1}),e(t,{class:"w-20 h-5 xl:h-6",lines:1})]),i("div",Pe,[e(t,{class:"h-3 w-14 xl:h-4",lines:1}),e(t,{class:"w-20 h-5 xl:h-6",lines:1})])])]),_:1})}const je=te(Te,[["render",Fe]]),Re={key:1,class:"grid grid-cols-12"},Le={class:"col-span-12 xl:col-span-9 xxl:col-span-10"},Me={class:"flex justify-between mt-1 mb-6"},Ne={class:"flex items-center"},Oe={class:"w-40 h-10"},Ue={class:"grid col-span-12 mt-6 text-center xl:mt-0 sm:grid-cols-4 xl:text-right xl:col-span-3 xl:grid-cols-1 xxl:col-span-2"},ze={class:"px-6 py-2"},He={class:"text-xs leading-5 lg:text-sm"},Ye={key:0,class:"block mt-1 text-xl font-semibold leading-8"},Ge={class:"px-6 py-2"},qe={class:"text-xs leading-5 lg:text-sm"},Xe={key:0,class:"block mt-1 text-xl font-semibold leading-8",style:{color:"#00c99c"}},Ke={class:"px-6 py-2"},Qe={class:"text-xs leading-5 lg:text-sm"},Je={key:0,class:"block mt-1 text-xl font-semibold leading-8",style:{color:"#fb7178"}},We={class:"px-6 py-2"},Ze={class:"text-xs leading-5 lg:text-sm"},et={key:0,class:"block mt-1 text-xl font-semibold leading-8",style:{color:"#5851d8"}},tt={__name:"CustomerChart",setup(L){const $=se(),t=N();K("utils");const{t:f}=U.useI18n(),y=O();let s=P(!1),r=M({}),x=M({}),h=M([{label:f("dateRange.this_year"),value:"This year"},{label:f("dateRange.previous_year"),value:"Previous year"}]),w=P("This year");const A=E(()=>r.expenseTotals?r.expenseTotals:[]),m=E(()=>r.netProfits?r.netProfits:[]),C=E(()=>r&&r.months?r.months:[]),k=E(()=>r.receiptTotals?r.receiptTotals:[]),T=E(()=>r.invoiceTotals?r.invoiceTotals:[]);ae(y,()=>{y.params.id&&g(),w.value="This year"},{immediate:!0});async function g(){s.value=!1;let n=await t.fetchViewCustomer({id:y.params.id});n.data&&(Object.assign(r,n.data.meta.chartData),Object.assign(x,n.data.data)),s.value=!0}async function I(n){let c={id:y.params.id};n==="Previous year"?c.previous_year=!0:c.this_year=!0;let v=await t.fetchViewCustomer(c);return v.data.meta.chartData&&Object.assign(r,v.data.meta.chartData),!0}return(n,c)=>{const v=u("BaseIcon"),F=u("BaseMultiselect"),S=u("BaseFormatMoney"),j=u("BaseCard");return a(),d(j,{class:"flex flex-col mt-6"},{default:o(()=>[l(t).isFetchingViewData?(a(),d(je,{key:0})):(a(),B("div",Re,[i("div",Le,[i("div",Me,[i("h6",Ne,[e(v,{name:"ChartBarSquareIcon",class:"h-5 text-primary-400"}),V(" "+_(n.$t("dashboard.monthly_chart.title")),1)]),i("div",Oe,[e(F,{modelValue:l(w),"onUpdate:modelValue":c[0]||(c[0]=R=>le(w)?w.value=R:w=R),options:l(h),"allow-empty":!1,"show-labels":!1,placeholder:n.$t("dashboard.select_year"),"can-deselect":!1,onSelect:I},null,8,["modelValue","options","placeholder"])])]),l(s)?(a(),d(ce,{key:0,invoices:T.value,expenses:A.value,receipts:k.value,income:m.value,labels:C.value,class:"sm:w-full"},null,8,["invoices","expenses","receipts","income","labels"])):p("",!0)]),i("div",Ue,[i("div",ze,[i("span",He,_(n.$t("dashboard.chart_info.total_sales")),1),c[1]||(c[1]=i("br",null,null,-1)),l(s)?(a(),B("span",Ye,[e(S,{amount:l(r).salesTotal,currency:l($).selectedCompanyCurrency},null,8,["amount","currency"])])):p("",!0)]),i("div",Ge,[i("span",qe,_(n.$t("dashboard.chart_info.total_receipts")),1),c[2]||(c[2]=i("br",null,null,-1)),l(s)?(a(),B("span",Xe,[e(S,{amount:l(r).totalReceipts,currency:l($).selectedCompanyCurrency},null,8,["amount","currency"])])):p("",!0)]),i("div",Ke,[i("span",Qe,_(n.$t("dashboard.chart_info.total_expense")),1),c[3]||(c[3]=i("br",null,null,-1)),l(s)?(a(),B("span",Je,[e(S,{amount:l(r).totalExpenses,currency:l($).selectedCompanyCurrency},null,8,["amount","currency"])])):p("",!0)]),i("div",We,[i("span",Ze,_(n.$t("dashboard.chart_info.net_income")),1),c[4]||(c[4]=i("br",null,null,-1)),l(s)?(a(),B("span",et,[e(S,{amount:l(r).netProfit,currency:l($).selectedCompanyCurrency},null,8,["amount","currency"])])):p("",!0)])])])),e(ke)]),_:1})}}},ot={__name:"View",setup(L){K("utils"),ne();const $=N(),t=oe(),{t:f}=U.useI18n(),y=re(),s=O();P(null);const r=E(()=>$.selectedViewCustomer.customer?$.selectedViewCustomer.customer.name:"");let x=E(()=>$.isFetchingViewData);function h(){return t.hasAbilities([D.CREATE_ESTIMATE,D.CREATE_INVOICE,D.CREATE_PAYMENT,D.CREATE_EXPENSE])}function w(){return t.hasAbilities([D.DELETE_CUSTOMER,D.EDIT_CUSTOMER])}function A(){y.push("/admin/customers")}return(m,C)=>{const k=u("BaseButton"),T=u("router-link"),g=u("BaseIcon"),I=u("BaseDropdownItem"),n=u("BaseDropdown"),c=u("BasePageHeader"),v=u("BasePage");return a(),d(v,{class:"xl:pl-96"},{default:o(()=>[e(c,{title:r.value},{actions:o(()=>[l(t).hasAbilities(l(D).EDIT_CUSTOMER)?(a(),d(T,{key:0,to:`/admin/customers/${l(s).params.id}/edit`},{default:o(()=>[e(k,{class:"mr-3",variant:"primary-outline","content-loading":l(x)},{default:o(()=>[V(_(m.$t("general.edit")),1)]),_:1},8,["content-loading"])]),_:1},8,["to"])):p("",!0),h()?(a(),d(n,{key:1,position:"bottom-end","content-loading":l(x)},{activator:o(()=>[e(k,{class:"mr-3",variant:"primary","content-loading":l(x)},{default:o(()=>[V(_(m.$t("customers.new_transaction")),1)]),_:1},8,["content-loading"])]),default:o(()=>[l(t).hasAbilities(l(D).CREATE_ESTIMATE)?(a(),d(T,{key:0,to:`/admin/estimates/create?customer=${m.$route.params.id}`},{default:o(()=>[e(I,{class:""},{default:o(()=>[e(g,{name:"DocumentIcon",class:"mr-3 text-gray-600"}),V(" "+_(m.$t("estimates.new_estimate")),1)]),_:1})]),_:1},8,["to"])):p("",!0),l(t).hasAbilities(l(D).CREATE_INVOICE)?(a(),d(T,{key:1,to:`/admin/invoices/create?customer=${m.$route.params.id}`},{default:o(()=>[e(I,null,{default:o(()=>[e(g,{name:"DocumentTextIcon",class:"mr-3 text-gray-600"}),V(" "+_(m.$t("invoices.new_invoice")),1)]),_:1})]),_:1},8,["to"])):p("",!0),l(t).hasAbilities(l(D).CREATE_PAYMENT)?(a(),d(T,{key:2,to:`/admin/payments/create?customer=${m.$route.params.id}`},{default:o(()=>[e(I,null,{default:o(()=>[e(g,{name:"CreditCardIcon",class:"mr-3 text-gray-600"}),V(" "+_(m.$t("payments.new_payment")),1)]),_:1})]),_:1},8,["to"])):p("",!0),l(t).hasAbilities(l(D).CREATE_EXPENSE)?(a(),d(T,{key:3,to:`/admin/expenses/create?customer=${m.$route.params.id}`},{default:o(()=>[e(I,null,{default:o(()=>[e(g,{name:"CalculatorIcon",class:"mr-3 text-gray-600"}),V(" "+_(m.$t("expenses.new_expense")),1)]),_:1})]),_:1},8,["to"])):p("",!0)]),_:1},8,["content-loading"])):p("",!0),w()?(a(),d(ue,{key:2,class:X({"ml-3":l(x)}),row:l($).selectedViewCustomer,"load-data":A},null,8,["class","row"])):p("",!0)]),_:1},8,["title"]),e(be),e(tt)]),_:1})}}};export{ot as default};
