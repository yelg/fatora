import{F as x,H as L,v as A,e as w,I as Z,j as f,P as F,i as H,c as K,a as r,w as d,m as C,r as m,f as p,g,o as M,b as h,l as e,q as D,t as U,M as O,K as J,L as Q}from"./main-DnObvGgc.js";const ee={__name:"PreferencesSetting",setup(R){const b=x(),s=L(),{t:c,tm:W}=A.useI18n();let v=w(!1),y=w(!1),i=w(!1);const a=Z({...b.selectedCompanySettings});f(()=>s.config.retrospective_edits.map(t=>(t.title=c(t.key),t)));const z=f(()=>s.config.fiscal_years.map(t=>Object.assign({},t,{key:c(t.key)})));F(()=>a.carbon_date_format,t=>{if(t){const n=s.dateFormats.find(u=>u.carbon_format_value===t);a.moment_date_format=n.moment_format_value}}),F(()=>a.carbon_time_format,t=>{if(t){const n=s.timeFormats.find(u=>u.carbon_format_value===t);a.moment_time_format=n.moment_format_value}});const k=f({get:()=>a.invoice_use_time==="YES",set:async t=>{const n=t?"YES":"NO";a.invoice_use_time=n}}),S=f({get:()=>a.discount_per_item==="YES",set:async t=>{const n=t?"YES":"NO";let u={settings:{discount_per_item:n}};a.discount_per_item=n,await b.updateCompanySettings({data:u,message:"general.setting_updated"})}}),$=f({get:()=>a.automatically_expire_public_links==="YES",set:async t=>{const n=t?"YES":"NO";a.automatically_expire_public_links=n}}),E=f(()=>({currency:{required:p.withMessage(c("validation.required"),g)},language:{required:p.withMessage(c("validation.required"),g)},carbon_date_format:{required:p.withMessage(c("validation.required"),g)},moment_date_format:{required:p.withMessage(c("validation.required"),g)},carbon_time_format:{required:p.withMessage(c("validation.required"),g)},moment_time_format:{required:p.withMessage(c("validation.required"),g)},time_zone:{required:p.withMessage(c("validation.required"),g)},fiscal_year:{required:p.withMessage(c("validation.required"),g)},invoice_use_time:{required:p.withMessage(c("validation.required"),g)}})),o=H(E,f(()=>a));N();async function N(){i.value=!0,Promise.all([s.fetchCurrencies(),s.fetchDateFormats(),s.fetchTimeFormats(),s.fetchTimeZones()]).then(([t])=>{i.value=!1})}async function Y(){if(o.value.$touch(),o.value.$invalid)return;let t={settings:{...a}};v.value=!0,delete t.settings.link_expiry_days,b.selectedCompanySettings.language!==a.language&&await window.loadLanguage(a.language),await b.updateCompanySettings({data:t,message:"settings.preferences.updated_message"}),v.value=!1}async function P(){y.value=!0,await b.updateCompanySettings({data:{settings:{link_expiry_days:a.link_expiry_days,automatically_expire_public_links:a.automatically_expire_public_links}},message:"settings.preferences.updated_message"}),y.value=!1}return(t,n)=>{const u=m("BaseMultiselect"),_=m("BaseInputGroup"),j=m("BaseInputGrid"),V=m("BaseSwitchSection"),q=m("BaseIcon"),B=m("BaseButton"),I=m("BaseDivider"),G=m("BaseInput"),T=m("BaseSettingCard");return M(),K("form",{action:"",class:"relative",onSubmit:C(Y,["prevent"])},[r(T,{title:t.$t("settings.menu_title.preferences"),description:t.$t("settings.preferences.general_settings")},{default:d(()=>[r(j,{class:"mt-5"},{default:d(()=>[r(_,{"content-loading":e(i),label:t.$t("settings.preferences.currency"),"help-text":t.$t("settings.preferences.company_currency_unchangeable"),error:e(o).currency.$error&&e(o).currency.$errors[0].$message,required:""},{default:d(()=>[r(u,{modelValue:a.currency,"onUpdate:modelValue":n[0]||(n[0]=l=>a.currency=l),"content-loading":e(i),options:e(s).currencies,label:"name","value-prop":"id",searchable:!0,"track-by":"name",invalid:e(o).currency.$error,disabled:"",class:"w-full"},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["content-loading","label","help-text","error"]),r(_,{label:t.$t("settings.preferences.default_language"),"content-loading":e(i),error:e(o).language.$error&&e(o).language.$errors[0].$message,required:""},{default:d(()=>[r(u,{modelValue:a.language,"onUpdate:modelValue":n[1]||(n[1]=l=>a.language=l),"content-loading":e(i),options:e(s).config.languages,label:"name","value-prop":"code",class:"w-full","track-by":"name",searchable:!0,invalid:e(o).language.$error},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"]),r(_,{label:t.$t("settings.preferences.time_zone"),"content-loading":e(i),error:e(o).time_zone.$error&&e(o).time_zone.$errors[0].$message,required:""},{default:d(()=>[r(u,{modelValue:a.time_zone,"onUpdate:modelValue":n[2]||(n[2]=l=>a.time_zone=l),"content-loading":e(i),options:e(s).timeZones,label:"key","value-prop":"value","track-by":"key",searchable:!0,invalid:e(o).time_zone.$error},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"]),r(_,{label:t.$t("settings.preferences.date_format"),"content-loading":e(i),error:e(o).carbon_date_format.$error&&e(o).carbon_date_format.$errors[0].$message,required:""},{default:d(()=>[r(u,{modelValue:a.carbon_date_format,"onUpdate:modelValue":n[3]||(n[3]=l=>a.carbon_date_format=l),"content-loading":e(i),options:e(s).dateFormats,label:"display_date","value-prop":"carbon_format_value","track-by":"display_date",searchable:!0,invalid:e(o).carbon_date_format.$error,class:"w-full"},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"]),r(_,{"content-loading":e(i),error:e(o).fiscal_year.$error&&e(o).fiscal_year.$errors[0].$message,label:t.$t("settings.preferences.fiscal_year"),required:""},{default:d(()=>[r(u,{modelValue:a.fiscal_year,"onUpdate:modelValue":n[4]||(n[4]=l=>a.fiscal_year=l),"content-loading":e(i),options:z.value,label:"key","value-prop":"value",invalid:e(o).fiscal_year.$error,"track-by":"key",searchable:!0,class:"w-full"},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["content-loading","error","label"]),r(_,{label:t.$t("settings.preferences.time_format"),"content-loading":e(i),error:e(o).carbon_time_format.$error&&e(o).carbon_time_format.$errors[0].$message,required:""},{default:d(()=>[r(u,{modelValue:a.carbon_time_format,"onUpdate:modelValue":n[5]||(n[5]=l=>a.carbon_time_format=l),"content-loading":e(i),options:e(s).timeFormats,label:"display_time","value-prop":"carbon_format_value","track-by":"display_time",searchable:!0,invalid:e(o).carbon_time_format.$error,class:"w-full"},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"])]),_:1}),r(V,{modelValue:k.value,"onUpdate:modelValue":n[6]||(n[6]=l=>k.value=l),title:t.$t("settings.preferences.invoice_use_time"),description:t.$t("settings.preferences.invoice_use_time_description")},null,8,["modelValue","title","description"]),r(B,{"content-loading":e(i),disabled:e(v),loading:e(v),type:"submit",class:"mt-6"},{left:d(l=>[r(q,{name:"ArrowDownOnSquareIcon",class:O(l.class)},null,8,["class"])]),default:d(()=>[D(" "+U(t.$t("settings.company_info.save")),1)]),_:1},8,["content-loading","disabled","loading"]),r(I,{class:"mt-6 mb-2"}),h("ul",null,[h("form",{onSubmit:C(P,["prevent"])},[r(V,{modelValue:$.value,"onUpdate:modelValue":n[7]||(n[7]=l=>$.value=l),title:t.$t("settings.preferences.expire_public_links"),description:t.$t("settings.preferences.expire_setting_description")},null,8,["modelValue","title","description"]),$.value?(M(),J(_,{key:0,"content-loading":e(i),label:t.$t("settings.preferences.expire_public_links"),class:"mt-2 mb-4"},{default:d(()=>[r(G,{modelValue:a.link_expiry_days,"onUpdate:modelValue":n[8]||(n[8]=l=>a.link_expiry_days=l),disabled:a.automatically_expire_public_links==="NO","content-loading":e(i),type:"number"},null,8,["modelValue","disabled","content-loading"])]),_:1},8,["content-loading","label"])):Q("",!0),r(B,{"content-loading":e(i),disabled:e(y),loading:e(y),type:"submit",class:"mt-6"},{left:d(l=>[r(q,{name:"ArrowDownOnSquareIcon",class:O(l.class)},null,8,["class"])]),default:d(()=>[D(" "+U(t.$t("general.save")),1)]),_:1},8,["content-loading","disabled","loading"])],32),r(I,{class:"mt-6 mb-2"}),r(V,{modelValue:S.value,"onUpdate:modelValue":n[9]||(n[9]=l=>S.value=l),title:t.$t("settings.preferences.discount_per_item"),description:t.$t("settings.preferences.discount_setting_description")},null,8,["modelValue","title","description"])])]),_:1},8,["title","description"])],32)}}};export{ee as default};
