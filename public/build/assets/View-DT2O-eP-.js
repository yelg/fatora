import{a_ as O,v as U,N as H,e as x,I as ee,j,S as te,r,c as F,o as d,b as y,a as e,w as a,t as w,K as I,L as R,Q as M,R as ne,M as ae,a7 as oe,n as G,O as q,a8 as se,q as N,l,V as L,P as re,a9 as ie}from"./main-DnObvGgc.js";import{L as le}from"./LoadingIcon-UlwLbdlO.js";import{_ as ce}from"./InvoiceIndexDropdown-CqloNa6W.js";import{_ as ue}from"./SendInvoiceModal-CdKzIyKq.js";import{_ as de}from"./RecurringInvoiceIndexDropdown-kEugmwfQ.js";import"./mail-driver-DqYWSwW8.js";const me={class:"fixed top-0 left-0 hidden h-full pt-16 pb-[6.4rem] ml-56 bg-white xl:ml-64 w-88 xl:block"},_e={class:"flex items-center justify-between px-4 pt-8 pb-2 border border-gray-200 border-solid height-full"},ve={class:"mb-6"},ge={class:"flex mb-6 ml-3",role:"group","aria-label":"First group"},pe={class:"px-2 py-1 pb-2 mb-1 mb-2 text-sm border-b border-gray-200 border-solid"},fe={class:"flex-2"},be={class:"mt-1 mb-2 text-xs not-italic font-medium leading-5 text-gray-600"},ye={class:"flex-1 whitespace-nowrap right"},Ie={class:"text-sm not-italic font-normal leading-5 text-right text-gray-600 est-date"},Be={key:0,class:"flex justify-center p-4 items-center"},he={key:1,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},xe={__name:"RecurringInvoiceViewSidebar",setup(A){const n=O(),{t:b}=U.useI18n(),c=H(),f=x(!1),i=x(null),g=x(1),p=x(1),m=x(null),t=ee({orderBy:null,orderByField:null,searchText:null}),k=j(()=>t.orderBy==="asc"||t.orderBy==null);function V(s){return c.params.id==s}async function B(s,_=!1){if(f.value)return;let v={};t.searchText!==""&&t.searchText!==null&&t.searchText!==void 0&&(v.search=t.searchText),t.orderBy!==null&&t.orderBy!==void 0&&(v.orderBy=t.orderBy),t.orderByField!==null&&t.orderByField!==void 0&&(v.orderByField=t.orderByField),f.value=!0;let S=await n.fetchRecurringInvoices({page:s,...v});f.value=!1,i.value=i.value?i.value:[],i.value=[...i.value,...S.data.data],g.value=s||1,p.value=S.data.meta.last_page;let h=i.value.find(E=>E.id==c.params.id);_==!1&&!h&&g.value<p.value&&Object.keys(v).length===0&&B(++g.value),h&&setTimeout(()=>{_==!1&&$()},500)}function $(){const s=document.getElementById(`recurring-invoice-${c.params.id}`);s&&(s.scrollIntoView({behavior:"smooth"}),s.classList.add("shake"),T())}function T(){m.value.addEventListener("scroll",s=>{s.target.scrollTop>0&&s.target.scrollTop+s.target.clientHeight>s.target.scrollHeight-200&&g.value<p.value&&B(++g.value,!0)})}async function o(){i.value=[],B()}function D(){return t.orderBy==="asc"?(t.orderBy="desc",o(),!0):(t.orderBy="asc",o(),!0)}return B(),o=te.debounce(o,500),(s,_)=>{var z;const v=r("BaseIcon"),S=r("BaseInput"),h=r("BaseButton"),E=r("BaseRadio"),C=r("BaseInputGroup"),P=r("BaseDropdownItem"),K=r("BaseDropdown"),Q=r("BaseText"),W=r("BaseRecurringInvoiceStatusLabel"),J=r("BaseRecurringInvoiceStatusBadge"),X=r("BaseFormatMoney"),Y=r("router-link");return d(),F("div",me,[y("div",_e,[y("div",ve,[e(S,{modelValue:t.searchText,"onUpdate:modelValue":_[0]||(_[0]=u=>t.searchText=u),placeholder:s.$t("general.search"),type:"text",variant:"gray",onInput:_[1]||(_[1]=u=>o())},{right:a(()=>[e(v,{name:"MagnifyingGlassIcon",class:"h-5 text-gray-400"})]),_:1},8,["modelValue","placeholder"])]),y("div",ge,[e(K,{class:"ml-3",position:"bottom-start"},{activator:a(()=>[e(h,{size:"md",variant:"gray"},{default:a(()=>[e(v,{name:"FunnelIcon",class:"h-5"})]),_:1})]),default:a(()=>[y("div",pe,w(s.$t("general.sort_by")),1),e(P,{class:"flex px-1 py-2 cursor-pointer"},{default:a(()=>[e(C,{class:"-mt-3 font-normal"},{default:a(()=>[e(E,{id:"filter_next_invoice_date",modelValue:t.orderByField,"onUpdate:modelValue":[_[2]||(_[2]=u=>t.orderByField=u),o],label:s.$t("recurring_invoices.next_invoice_date"),size:"sm",name:"filter",value:"next_invoice_at"},null,8,["modelValue","label"])]),_:1})]),_:1}),e(P,{class:"flex px-1 py-2 cursor-pointer"},{default:a(()=>[e(C,{class:"-mt-3 font-normal"},{default:a(()=>[e(E,{id:"filter_start_date",modelValue:t.orderByField,"onUpdate:modelValue":[_[3]||(_[3]=u=>t.orderByField=u),o],label:s.$t("recurring_invoices.starts_at"),value:"starts_at",size:"sm",name:"filter"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),e(h,{class:"ml-1",size:"md",variant:"gray",onClick:D},{default:a(()=>[k.value?(d(),I(v,{key:0,name:"SortAscendingIcon",class:"h-5"})):(d(),I(v,{key:1,name:"SortDescendingIcon",class:"h-5"}))]),_:1})])]),y("div",{ref_key:"invoiceListSection",ref:m,class:"h-full overflow-y-scroll border-l border-gray-200 border-solid base-scroll"},[(d(!0),F(M,null,ne(i.value,(u,Z)=>(d(),F("div",{key:Z},[u?(d(),I(Y,{key:0,id:"recurring-invoice-"+u.id,to:`/admin/recurring-invoices/${u.id}/view`,class:ae(["flex justify-between side-invoice p-4 cursor-pointer hover:bg-gray-100 items-center border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":V(u.id)}]),style:{"border-bottom":"1px solid rgba(185, 193, 209, 0.41)"}},{default:a(()=>[y("div",fe,[e(Q,{text:u.customer.name,class:"pr-2 mb-2 text-sm not-italic font-normal leading-5 text-black capitalize truncate"},null,8,["text"]),y("div",be,w(u.invoice_number),1),e(J,{status:u.status,class:"px-1 text-xs"},{default:a(()=>[e(W,{status:u.status},null,8,["status"])]),_:2},1032,["status"])]),y("div",ye,[e(X,{class:"block mb-2 text-xl not-italic font-semibold leading-8 text-right text-gray-900",amount:u.total,currency:u.customer.currency},null,8,["amount","currency"]),y("div",Ie,w(u.formatted_starts_at),1)])]),_:2},1032,["id","to","class"])):R("",!0)]))),128)),f.value?(d(),F("div",Be,[e(le,{class:"h-6 m-1 animate-spin text-primary-400"})])):R("",!0),!((z=i.value)!=null&&z.length)&&!f.value?(d(),F("p",he,w(s.$t("invoices.no_matching_invoices")),1)):R("",!0)],512)])}}},we={class:"relative table-container"},Re={__name:"Invoices",setup(A){const n=O(),b=x(null);x(null),oe("$utils");const{t:c}=U.useI18n();x(null),G();const f=q(),i=j(()=>[{key:"invoice_date",label:c("invoices.date"),thClass:"extra",tdClass:"font-medium text-gray-900"},{key:"invoice_number",label:c("invoices.invoice")},{key:"customer.name",label:c("invoices.customer")},{key:"status",label:c("invoices.status")},{key:"total",label:c("invoices.total")},{key:"actions",label:c("invoices.action"),tdClass:"text-right text-sm font-medium",thClass:"text-right",sortable:!1}]);function g(){return f.hasAbilities([L.DELETE_INVOICE,L.EDIT_INVOICE,L.VIEW_INVOICE,L.SEND_INVOICE])}function p(m){let t=n.newRecurringInvoice.invoices.findIndex(k=>k.id===m);n.newRecurringInvoice.invoices[t]&&(n.newRecurringInvoice.invoices[t].status="SENT")}return(m,t)=>{const k=r("router-link"),V=r("BaseFormatMoney"),B=r("BaseInvoiceStatusLabel"),$=r("BaseInvoiceStatusBadge"),T=r("BaseTable");return d(),F(M,null,[e(ue,{onUpdate:p}),y("div",we,[e(T,{ref_key:"table",ref:b,data:l(n).newRecurringInvoice.invoices,columns:i.value,loading:l(n).isFetchingViewData,"placeholder-count":5,class:"mt-5"},se({"cell-invoice_number":a(({row:o})=>[e(k,{to:{path:`/admin/invoices/${o.data.id}/view`},class:"font-medium text-primary-500"},{default:a(()=>[N(w(o.data.invoice_number),1)]),_:2},1032,["to"])]),"cell-total":a(({row:o})=>[e(V,{amount:o.data.due_amount,currency:o.data.currency},null,8,["amount","currency"])]),"cell-invoice_date":a(({row:o})=>[N(w(o.data.formatted_invoice_date),1)]),"cell-status":a(({row:o})=>[e($,{status:o.data.status,class:"px-3 py-1"},{default:a(()=>[e(B,{status:o.data.status},null,8,["status"])]),_:2},1032,["status"])]),_:2},[g()?{name:"cell-actions",fn:a(({row:o})=>[e(ce,{row:o.data,table:b.value},null,8,["row","table"])]),key:"0"}:void 0]),1032,["data","columns","loading"])])],64)}}},ke={__name:"RecurringInvoiceInfo",setup(A){const n=O(),b=H();let c=j(()=>n.isFetchingViewData);re(b,()=>{b.params.id&&b.name==="recurring-invoices.view"&&f()},{immediate:!0});async function f(){await n.fetchRecurringInvoice(b.params.id)}return(i,g)=>{const p=r("BaseHeading"),m=r("BaseDescriptionListItem"),t=r("BaseDescriptionList"),k=r("BaseCard");return d(),I(k,{class:"mt-10"},{default:a(()=>[e(p,null,{default:a(()=>[N(w(i.$t("customers.basic_info")),1)]),_:1}),e(t,{class:"mt-5"},{default:a(()=>{var V,B,$,T,o,D,s,_,v,S,h,E,C;return[e(m,{label:i.$t("recurring_invoices.starts_at"),"content-loading":l(c),value:(V=l(n).newRecurringInvoice)==null?void 0:V.formatted_starts_at},null,8,["label","content-loading","value"]),e(m,{label:i.$t("recurring_invoices.next_invoice_date"),"content-loading":l(c),value:(B=l(n).newRecurringInvoice)==null?void 0:B.formatted_next_invoice_at},null,8,["label","content-loading","value"]),($=l(n).newRecurringInvoice)!=null&&$.limit_date&&((T=l(n).newRecurringInvoice)==null?void 0:T.limit_by)!=="NONE"?(d(),I(m,{key:0,label:i.$t("recurring_invoices.limit_date"),"content-loading":l(c),value:(o=l(n).newRecurringInvoice)==null?void 0:o.limit_date},null,8,["label","content-loading","value"])):R("",!0),(D=l(n).newRecurringInvoice)!=null&&D.limit_date&&((s=l(n).newRecurringInvoice)==null?void 0:s.limit_by)!=="NONE"?(d(),I(m,{key:1,label:i.$t("recurring_invoices.limit_by"),"content-loading":l(c),value:(_=l(n).newRecurringInvoice)==null?void 0:_.limit_by},null,8,["label","content-loading","value"])):R("",!0),(v=l(n).newRecurringInvoice)!=null&&v.limit_count?(d(),I(m,{key:2,label:i.$t("recurring_invoices.limit_count"),value:(S=l(n).newRecurringInvoice)==null?void 0:S.limit_count,"content-loading":l(c)},null,8,["label","value","content-loading"])):R("",!0),(h=l(n).newRecurringInvoice)!=null&&h.selectedFrequency?(d(),I(m,{key:3,label:i.$t("recurring_invoices.frequency.title"),value:(C=(E=l(n).newRecurringInvoice)==null?void 0:E.selectedFrequency)==null?void 0:C.label,"content-loading":l(c)},null,8,["label","value","content-loading"])):R("",!0)]}),_:1}),e(p,{class:"mt-8"},{default:a(()=>[N(w(i.$t("invoices.title",2)),1)]),_:1}),e(Re)]),_:1})}}},Le={__name:"View",setup(A){ie();const n=O(),b=q(),{t:c}=U.useI18n();G();const f=j(()=>{var g,p;return n.newRecurringInvoice?(p=(g=n.newRecurringInvoice)==null?void 0:g.customer)==null?void 0:p.name:""});function i(){return b.hasAbilities([L.DELETE_RECURRING_INVOICE,L.EDIT_RECURRING_INVOICE])}return(g,p)=>{const m=r("BasePageHeader"),t=r("BasePage");return d(),I(t,{class:"xl:pl-96"},{default:a(()=>[e(m,{title:f.value},{actions:a(()=>[i()?(d(),I(de,{key:0,row:l(n).newRecurringInvoice},null,8,["row"])):R("",!0)]),_:1},8,["title"]),e(xe),e(ke)]),_:1})}}};export{Le as default};
