import{au as Q,av as Z,G as ee,F as te,v as ne,O as ae,e as b,j as d,i as oe,V as le,N as se,K as V,w as l,r as s,n as re,f as w,ah as ie,J as ue,g as me,o as h,a as o,b as U,m as ce,L as N,l as n,q as P,t as k,M as de}from"./main-DnObvGgc.js";import{_ as pe}from"./ItemUnitModal-CnQ-TJh6.js";const ge={__name:"Create",setup(_e){const t=Q(),S=Z(),g=ee(),v=te(),{t:p}=ne.useI18n(),y=se(),q=re(),E=ae(),_=b(!1),B=b(v.selectedCompanySettings.tax_per_item);let r=b(!1);t.$reset(),D();const $=d({get:()=>t.currentItem.price/100,set:e=>{t.currentItem.price=Math.round(e*100)}}),x=d({get:()=>{var e,a;return(a=(e=t==null?void 0:t.currentItem)==null?void 0:e.taxes)==null?void 0:a.map(u=>{if(u)return{...u,tax_type_id:u.id,tax_name:`${u.name} (${u.calculation_type==="fixed"?new Intl.NumberFormat(void 0,{style:"currency",currency:v.selectedCompanyCurrency.code}).format(u.fixed_amount/100):`${u.percent}%`})`}})},set:e=>{t.currentItem.taxes=e}}),I=d(()=>y.name==="items.edit"),M=d(()=>I.value?p("items.edit_item"):p("items.new_item")),A=d(()=>S.taxTypes.map(e=>({...e,tax_type_id:e.id,tax_name:`${e.name} (${e.calculation_type==="fixed"?new Intl.NumberFormat(void 0,{style:"currency",currency:v.selectedCompanyCurrency.code}).format(e.fixed_amount/100):`${e.percent}%`})`}))),G=d(()=>B.value==="YES"),L=d(()=>({currentItem:{name:{required:w.withMessage(p("validation.required"),me),minLength:w.withMessage(p("validation.name_min_length",{count:2}),ue(2))},description:{maxLength:w.withMessage(p("validation.description_maxlength"),ie(65e3))}}})),m=oe(L,t);async function z(){g.openModal({title:p("settings.customization.items.add_item_unit"),componentName:"ItemUnitModal",size:"sm"})}async function D(){if(r.value=!0,await t.fetchItemUnits({limit:"all"}),E.hasAbilities(le.VIEW_TAX_TYPE)&&await S.fetchTaxTypes({limit:"all"}),I.value){let e=y.params.id;await t.fetchItem(e),t.currentItem.tax_per_item===1?B.value="YES":B.value="NO"}r.value=!1}async function F(){if(m.value.currentItem.$touch(),m.value.currentItem.$invalid)return!1;_.value=!0;try{let a={id:y.params.id,...t.currentItem};t.currentItem&&t.currentItem.taxes&&(a.taxes=t.currentItem.taxes.map(c=>({tax_type_id:c.tax_type_id,calculation_type:c.calculation_type,fixed_amount:c.fixed_amount,amount:c.calculation_type==="fixed"?c.fixed_amount:Math.round($.value*c.percent),percent:c.percent,name:c.name,collective_tax:0}))),await(I.value?t.updateItem:t.addItem)(a),_.value=!1,q.push("/admin/items"),e()}catch{_.value=!1;return}function e(){g.closeModal(),setTimeout(()=>{t.resetCurrentItem(),g.$reset(),m.value.$reset()},300)}}return(e,a)=>{const u=s("BaseBreadcrumbItem"),c=s("BaseBreadcrumb"),j=s("BasePageHeader"),O=s("BaseInput"),f=s("BaseInputGroup"),Y=s("BaseMoney"),T=s("BaseIcon"),H=s("BaseSelectAction"),C=s("BaseMultiselect"),R=s("BaseTextarea"),J=s("BaseButton"),K=s("BaseInputGrid"),W=s("BaseCard"),X=s("BasePage");return h(),V(X,null,{default:l(()=>[o(j,{title:M.value},{default:l(()=>[o(c,null,{default:l(()=>[o(u,{title:e.$t("general.home"),to:"dashboard"},null,8,["title"]),o(u,{title:e.$t("items.item",2),to:"/admin/items"},null,8,["title"]),o(u,{title:M.value,to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),o(pe),U("form",{class:"grid lg:grid-cols-2 mt-6",action:"submit",onSubmit:ce(F,["prevent"])},[o(W,{class:"w-full"},{default:l(()=>[o(K,{layout:"one-column"},{default:l(()=>[o(f,{label:e.$t("items.name"),"content-loading":n(r),required:"",error:n(m).currentItem.name.$error&&n(m).currentItem.name.$errors[0].$message},{default:l(()=>[o(O,{modelValue:n(t).currentItem.name,"onUpdate:modelValue":a[0]||(a[0]=i=>n(t).currentItem.name=i),"content-loading":n(r),invalid:n(m).currentItem.name.$error,onInput:a[1]||(a[1]=i=>n(m).currentItem.name.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),o(f,{label:e.$t("items.price"),"content-loading":n(r)},{default:l(()=>[o(Y,{modelValue:$.value,"onUpdate:modelValue":a[2]||(a[2]=i=>$.value=i),"content-loading":n(r)},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),o(f,{"content-loading":n(r),label:e.$t("items.unit")},{default:l(()=>[o(C,{modelValue:n(t).currentItem.unit_id,"onUpdate:modelValue":a[3]||(a[3]=i=>n(t).currentItem.unit_id=i),"content-loading":n(r),label:"name",options:n(t).itemUnits,"value-prop":"id",placeholder:e.$t("items.select_a_unit"),searchable:"","track-by":"name"},{action:l(()=>[o(H,{onClick:z},{default:l(()=>[o(T,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),P(" "+k(e.$t("settings.customization.items.add_item_unit")),1)]),_:1})]),_:1},8,["modelValue","content-loading","options","placeholder"])]),_:1},8,["content-loading","label"]),G.value?(h(),V(f,{key:0,label:e.$t("items.taxes"),"content-loading":n(r)},{default:l(()=>[o(C,{modelValue:x.value,"onUpdate:modelValue":a[4]||(a[4]=i=>x.value=i),"content-loading":n(r),options:A.value,mode:"tags",label:"tax_name",class:"w-full","value-prop":"id","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"tax_name",object:""},null,8,["modelValue","content-loading","options"])]),_:1},8,["label","content-loading"])):N("",!0),o(f,{label:e.$t("items.description"),"content-loading":n(r),error:n(m).currentItem.description.$error&&n(m).currentItem.description.$errors[0].$message},{default:l(()=>[o(R,{modelValue:n(t).currentItem.description,"onUpdate:modelValue":a[5]||(a[5]=i=>n(t).currentItem.description=i),"content-loading":n(r),name:"description",row:2,rows:"2",onInput:a[6]||(a[6]=i=>n(m).currentItem.description.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),U("div",null,[o(J,{"content-loading":n(r),type:"submit",loading:_.value},{left:l(i=>[_.value?N("",!0):(h(),V(T,{key:0,name:"ArrowDownOnSquareIcon",class:de(i.class)},null,8,["class"]))]),default:l(()=>[P(" "+k(I.value?e.$t("items.update_item"):e.$t("items.save_item")),1)]),_:1},8,["content-loading","loading"])])]),_:1})]),_:1})],32)]),_:1})}}};export{ge as default};
