import{N as j,a_ as A,H as ee,v as G,e as D,I as ne,j as p,P as O,k as ie,r as d,c as H,o as y,b as v,a as t,l as e,t as T,K as _,L as S,w as u,aq as te,Q as Y,F as re,ag as oe,aw as ae,G as le,aa as se,u as ce,f,$ as ue,g as q,aj as x,i as de,n as ge,m as ve,q as me,M as fe}from"./main-DnObvGgc.js";import{_ as ye,a as Ie,b as be,c as _e,d as we,e as $e,f as Re}from"./SalesTax-CYrASWLJ.js";import{_ as qe}from"./ExchangeRateConverter-Bb7rrT2I.js";import{_ as pe}from"./CreateCustomFields-CBKwtRG5.js";import{_ as Be}from"./TaxTypeModal-Byuj8aRW.js";import"./DragIcon-DZ4DjgJ9.js";import"./SelectNotePopup-D_ZaygaK.js";import"./NoteModal-Dr6YmiAY.js";import"./payment-COlo_rP3.js";import"./exchange-rate-C4tOL1sk.js";const Se={class:"col-span-5 pr-0"},he={class:"flex mt-7"},Ce={class:"relative w-20 mt-8"},Ve={class:"ml-2"},ke={class:"p-0 mb-1 leading-snug text-left text-black"},Fe={class:"p-0 m-0 text-xs leading-tight text-left text-gray-500",style:{"max-width":"480px"}},Le={class:"grid grid-cols-1 col-span-7 gap-4 mt-8 lg:gap-6 lg:mt-0 lg:grid-cols-2"},Me={__name:"RecurringInvoiceCreateBasicFields",props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(n){const o=n,h=j(),i=A(),k=ee(),{t:w}=G.useI18n(),$=D(!1),U=ne([{label:w("recurring_invoices.limit.none"),value:"NONE"},{label:w("recurring_invoices.limit.date"),value:"DATE"},{label:w("recurring_invoices.limit.count"),value:"COUNT"}]),c=p(()=>i.newRecurringInvoice.selectedFrequency&&i.newRecurringInvoice.selectedFrequency.value==="CUSTOM"),m=p(()=>o.isEdit?k.config.recurring_invoice_status.update_status.map(r=>Object.assign({},r,{key:w(r.key)})):k.config.recurring_invoice_status.create_status.map(r=>Object.assign({},r,{key:w(r.key)})));O(()=>i.newRecurringInvoice.selectedFrequency,r=>{i.isFetchingInitialSettings||(r&&r.value!=="CUSTOM"?i.newRecurringInvoice.frequency=r.value:i.newRecurringInvoice.frequency=null)}),ie(()=>{h.params.id||R()});function B(r){return i.newRecurringInvoice.limit_by===r}const F=te(()=>{R()},500);async function R(){const r=i.newRecurringInvoice.frequency;if(!r)return;$.value=!0;let a={starts_at:i.newRecurringInvoice.starts_at,frequency:r};try{await i.fetchRecurringInvoiceFrequencyDate(a)}catch(I){console.error(I),$.value=!1}$.value=!1}return(r,a)=>{const I=d("BaseCustomerSelectPopup"),N=d("BaseSwitch"),C=d("BaseDatePicker"),g=d("BaseInputGroup"),V=d("BaseMultiselect"),L=d("BaseInput");return y(),H(Y,null,[v("div",Se,[t(I,{modelValue:e(i).newRecurringInvoice.customer,"onUpdate:modelValue":a[0]||(a[0]=s=>e(i).newRecurringInvoice.customer=s),valid:n.v.customer_id,"content-loading":n.isLoading,type:"recurring-invoice"},null,8,["modelValue","valid","content-loading"]),v("div",he,[v("div",Ce,[t(N,{modelValue:e(i).newRecurringInvoice.send_automatically,"onUpdate:modelValue":a[1]||(a[1]=s=>e(i).newRecurringInvoice.send_automatically=s),class:"absolute -top-4"},null,8,["modelValue"])]),v("div",Ve,[v("p",ke,T(r.$t("recurring_invoices.send_automatically")),1),v("p",Fe,T(r.$t("recurring_invoices.send_automatically_desc")),1)])])]),v("div",Le,[t(g,{label:r.$t("recurring_invoices.starts_at"),"content-loading":n.isLoading,required:"",error:n.v.starts_at.$error&&n.v.starts_at.$errors[0].$message},{default:u(()=>[t(C,{modelValue:e(i).newRecurringInvoice.starts_at,"onUpdate:modelValue":a[2]||(a[2]=s=>e(i).newRecurringInvoice.starts_at=s),"content-loading":n.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar",invalid:n.v.starts_at.$error,onChange:a[3]||(a[3]=s=>R())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),t(g,{label:r.$t("recurring_invoices.next_invoice_date"),"content-loading":n.isLoading,required:""},{default:u(()=>[t(C,{modelValue:e(i).newRecurringInvoice.next_invoice_at,"onUpdate:modelValue":a[4]||(a[4]=s=>e(i).newRecurringInvoice.next_invoice_at=s),"content-loading":n.isLoading,"calendar-button":!0,disabled:!0,loading:$.value,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading","loading"])]),_:1},8,["label","content-loading"]),t(g,{label:r.$t("recurring_invoices.limit_by"),"content-loading":n.isLoading,class:"lg:mt-0",required:"",error:n.v.limit_by.$error&&n.v.limit_by.$errors[0].$message},{default:u(()=>[t(V,{modelValue:e(i).newRecurringInvoice.limit_by,"onUpdate:modelValue":a[5]||(a[5]=s=>e(i).newRecurringInvoice.limit_by=s),"content-loading":n.isLoading,options:U,label:"label",invalid:n.v.limit_by.$error,"value-prop":"value"},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"]),B("DATE")?(y(),_(g,{key:0,label:r.$t("recurring_invoices.limit_date"),"content-loading":n.isLoading,required:B("DATE"),error:n.v.limit_date.$error&&n.v.limit_date.$errors[0].$message},{default:u(()=>[t(C,{modelValue:e(i).newRecurringInvoice.limit_date,"onUpdate:modelValue":a[6]||(a[6]=s=>e(i).newRecurringInvoice.limit_date=s),"content-loading":n.isLoading,invalid:n.v.limit_date.$error,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","required","error"])):S("",!0),B("COUNT")?(y(),_(g,{key:1,label:r.$t("recurring_invoices.count"),"content-loading":n.isLoading,required:B("COUNT"),error:n.v.limit_count.$error&&n.v.limit_count.$errors[0].$message},{default:u(()=>[t(L,{modelValue:e(i).newRecurringInvoice.limit_count,"onUpdate:modelValue":a[7]||(a[7]=s=>e(i).newRecurringInvoice.limit_count=s),"content-loading":n.isLoading,invalid:n.v.limit_count.$error,type:"number"},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","required","error"])):S("",!0),t(g,{label:r.$t("recurring_invoices.status"),required:"","content-loading":n.isLoading,error:n.v.status.$error&&n.v.status.$errors[0].$message},{default:u(()=>[t(V,{modelValue:e(i).newRecurringInvoice.status,"onUpdate:modelValue":a[8]||(a[8]=s=>e(i).newRecurringInvoice.status=s),options:m.value,"content-loading":n.isLoading,invalid:n.v.status.$error,placeholder:r.$t("recurring_invoices.select_a_status"),"value-prop":"value",label:"key"},null,8,["modelValue","options","content-loading","invalid","placeholder"])]),_:1},8,["label","content-loading","error"]),t(g,{label:r.$t("recurring_invoices.frequency.select_frequency"),required:"","content-loading":n.isLoading,error:n.v.selectedFrequency.$error&&n.v.selectedFrequency.$errors[0].$message},{default:u(()=>[t(V,{modelValue:e(i).newRecurringInvoice.selectedFrequency,"onUpdate:modelValue":a[9]||(a[9]=s=>e(i).newRecurringInvoice.selectedFrequency=s),"content-loading":n.isLoading,options:e(i).frequencies,label:"label",invalid:n.v.selectedFrequency.$error,object:"",onChange:R},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"]),c.value?(y(),_(g,{key:2,label:r.$t("recurring_invoices.frequency.title"),"content-loading":n.isLoading,required:"",error:n.v.frequency.$error&&n.v.frequency.$errors[0].$message},{default:u(()=>[t(L,{modelValue:e(i).newRecurringInvoice.frequency,"onUpdate:modelValue":[a[10]||(a[10]=s=>e(i).newRecurringInvoice.frequency=s),e(F)],"content-loading":n.isLoading,disabled:!c.value,invalid:n.v.frequency.$error,loading:$.value},null,8,["modelValue","content-loading","disabled","invalid","loading","onUpdate:modelValue"])]),_:1},8,["label","content-loading","error"])):S("",!0),t(qe,{store:e(i),"store-prop":"newRecurringInvoice",v:n.v,"is-loading":n.isLoading,"is-edit":n.isEdit,"customer-currency":e(i).newRecurringInvoice.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])])],64)}}},Te={class:"flex"},Ue={class:"grid-cols-12 gap-8 mt-6 mb-8 lg:grid"},Ne={class:"block mt-10 invoice-foot lg:flex lg:justify-between lg:items-start"},xe={class:"w-full relative lg:w-1/2"},E="newRecurringInvoice",Ke={__name:"RecurringInvoiceCreate",setup(n){const o=A(),h=re(),i=oe(),k=ae(),w=le(),$=se(),U=ce(),{t:c}=G.useI18n();let m=D(!1);const B=D(["customer","company","customerCustom","invoice","invoiceCustom"]);let F=j(),R=ge(),r=p(()=>o.isFetchingInvoice||o.isFetchingInitialSettings),a=p(()=>I.value?c("recurring_invoices.edit_invoice"):c("recurring_invoices.new_invoice")),I=p(()=>F.name==="recurring-invoices.edit");const N=p(()=>h.selectedCompanySettings.sales_tax_us_enabled==="YES"&&k.salesTaxUSEnabled),C={starts_at:{required:f.withMessage(c("validation.required"),q)},status:{required:f.withMessage(c("validation.required"),q)},frequency:{required:f.withMessage(c("validation.required"),q)},limit_by:{required:f.withMessage(c("validation.required"),q)},limit_date:{required:f.withMessage(c("validation.required"),x(function(){return o.newRecurringInvoice.limit_by==="DATE"}))},limit_count:{required:f.withMessage(c("validation.required"),x(function(){return o.newRecurringInvoice.limit_by==="COUNT"}))},selectedFrequency:{required:f.withMessage(c("validation.required"),q)},customer_id:{required:f.withMessage(c("validation.required"),q)},exchange_rate:{required:x(function(){return f.withMessage(c("validation.required"),q),o.showExchangeRate}),decimal:f.withMessage(c("validation.valid_exchange_rate"),ue)}},g=de(C,p(()=>o.newRecurringInvoice),{$scope:E});o.resetCurrentRecurringInvoice(),o.fetchRecurringInvoiceInitialSettings(I.value),i.resetCustomFields(),g.value.$reset,O(()=>o.newRecurringInvoice.customer,l=>{l&&l.currency?o.newRecurringInvoice.currency=l.currency:o.newRecurringInvoice.currency=h.selectedCompanyCurrency}),O(()=>{var l;return(l=h.selectedCompanySettings)==null?void 0:l.tax_included_by_default},l=>{o.newRecurringInvoice.tax_included=l==="YES"},{immediate:!0});async function V(){if(g.value.$touch(),g.value.$invalid)return!1;m.value=!0;let l={...o.newRecurringInvoice,sub_total:o.getSubTotal,total:o.getTotal,tax:o.getTotalTax};if(l.customer&&!l.customer.email&&l.send_automatically){U.showNotification({type:"error",message:c("recurring_invoices.add_customer_email")}),L(),m.value=!1;return}F.params.id?o.updateRecurringInvoice(l).then(b=>{b.data.data&&R.push(`/admin/recurring-invoices/${b.data.data.id}/view`),m.value=!1}).catch(b=>{m.value=!1}):s(l)}async function L(){let l=o.newRecurringInvoice.customer.id;await $.fetchCustomer(l),w.openModal({title:c("customers.edit_customer"),componentName:"CustomerModal"})}function s(l){o.addRecurringInvoice(l).then(b=>{b.data.data&&R.push(`/admin/recurring-invoices/${b.data.data.id}/view`),m.value=!1}).catch(b=>{m.value=!1})}return(l,b)=>{const M=d("BaseBreadcrumbItem"),z=d("BaseBreadcrumb"),P=d("BaseButton"),K=d("router-link"),Q=d("BaseIcon"),J=d("BasePageHeader"),W=d("BaseScrollPane"),X=d("BasePage");return y(),H(Y,null,[t(Ie),t(be),t(Be),N.value&&!e(r)?(y(),_(ye,{key:0,store:e(o),"store-prop":"newRecurringInvoice","is-edit":e(I),customer:e(o).newRecurringInvoice.customer},null,8,["store","is-edit","customer"])):S("",!0),t(X,{class:"relative invoice-create-page"},{default:u(()=>[v("form",{onSubmit:ve(V,["prevent"])},[t(J,{title:e(a)},{actions:u(()=>[t(K,{to:`/invoices/pdf/${e(o).newRecurringInvoice.unique_hash}`},{default:u(()=>[l.$route.name==="invoices.edit"?(y(),_(P,{key:0,target:"_blank",class:"mr-3",variant:"primary-outline",type:"button"},{default:u(()=>[v("span",Te,T(l.$t("general.view_pdf")),1)]),_:1})):S("",!0)]),_:1},8,["to"]),t(P,{loading:e(m),disabled:e(m),variant:"primary",type:"submit"},{left:u(Z=>[e(m)?S("",!0):(y(),_(Q,{key:0,name:"ArrowDownOnSquareIcon",class:fe(Z.class)},null,8,["class"]))]),default:u(()=>[me(" "+T(l.$t("recurring_invoices.save_invoice")),1)]),_:1},8,["loading","disabled"])]),default:u(()=>[t(z,null,{default:u(()=>[t(M,{title:l.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),t(M,{title:l.$t("recurring_invoices.title",2),to:"/admin/recurring-invoices"},null,8,["title"]),l.$route.name==="invoices.edit"?(y(),_(M,{key:0,title:l.$t("recurring_invoices.edit_invoice"),to:"#",active:""},null,8,["title"])):(y(),_(M,{key:1,title:e(a),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),v("div",Ue,[t(Me,{v:e(g),"is-loading":e(r),"is-edit":e(I)},null,8,["v","is-loading","is-edit"])]),t(W,null,{default:u(()=>[t(_e,{currency:e(o).newRecurringInvoice.currency,"is-loading":e(r),"item-validation-scope":E,store:e(o),"store-prop":"newRecurringInvoice"},null,8,["currency","is-loading","store"]),v("div",Ne,[v("div",xe,[t(we,{store:e(o),"store-prop":"newRecurringInvoice",fields:B.value,type:"Invoice"},null,8,["store","fields"]),t(pe,{type:"Invoice","is-edit":e(I),"is-loading":e(r),store:e(o),"store-prop":"newRecurringInvoice","custom-field-scope":E,class:"mb-6"},null,8,["is-edit","is-loading","store"]),t($e,{store:e(o),"store-prop":"newRecurringInvoice"},null,8,["store"])]),t(Re,{currency:e(o).newRecurringInvoice.currency,"is-loading":e(r),store:e(o),"store-prop":"newRecurringInvoice","tax-popup-type":"invoice"},null,8,["currency","is-loading","store"])])]),_:1})],32)]),_:1})],64)}}};export{Ke as default};
