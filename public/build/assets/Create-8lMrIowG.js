import{aa as de,F as ie,ag as ce,G as pe,v as me,H as xe,e as q,j as $,i as ge,N as _e,aG as ye,c as fe,a as r,w as o,Q as ve,r as d,n as Ee,f as x,aj as be,$ as $e,g as h,ah as N,aP as he,o as f,b as k,m as Ce,K as E,L as C,l as e,q as w,t as I,M as F}from"./main-DnObvGgc.js";import{u as Be}from"./expense-Dl2RXkLy.js";import{u as Ve}from"./category-CzaztFkO.js";import{_ as we}from"./CreateCustomFields-CBKwtRG5.js";import{_ as Ie}from"./CategoryModal-DjTQvGU1.js";import{_ as Me}from"./ExchangeRateConverter-Bb7rrT2I.js";import"./exchange-rate-C4tOL1sk.js";const Se={class:"hidden md:block"},qe={class:"block md:hidden"},j="newExpense",je={__name:"Create",setup(ke){const _=de(),D=ie(),t=Be(),y=Ve(),A=ce(),L=pe(),v=_e(),O=Ee(),{t:i}=me.useI18n(),U=xe();let g=q(!1),l=q(!1);const M=q(!1),T=$(()=>({currentExpense:{expense_category_id:{required:x.withMessage(i("validation.required"),h)},expense_date:{required:x.withMessage(i("validation.required"),h)},amount:{required:x.withMessage(i("validation.required"),h),minValue:x.withMessage(i("validation.price_minvalue"),he(.1)),maxLength:x.withMessage(i("validation.price_maxlength"),N(20))},notes:{maxLength:x.withMessage(i("validation.description_maxlength"),N(65e3))},currency_id:{required:x.withMessage(i("validation.required"),h)},exchange_rate:{required:be(function(){return x.withMessage(i("validation.required"),h),t.showExchangeRate}),decimal:x.withMessage(i("validation.valid_exchange_rate"),$e)}}})),u=ge(T,t,{$scope:j}),P=$({get:()=>t.currentExpense.amount/100,set:a=>{t.currentExpense.amount=Math.round(a*100)}}),c=$(()=>v.name==="expenses.edit"),R=$(()=>c.value?i("expenses.edit_expense"):i("expenses.new_expense")),H=$(()=>c.value?`/reports/expenses/${v.params.id}/download-receipt`:"");t.resetCurrentExpenseData(),A.resetCustomFields(),Y();function z(a,n){t.currentExpense.attachment_receipt=n}function K(){t.currentExpense.attachment_receipt=null,M.value=!0}function Q(){L.openModal({title:i("settings.expense_category.add_category"),componentName:"CategoryModal",size:"sm"})}function J(a){t.currentExpense.selectedCurrency=U.currencies.find(n=>n.id===a)}async function W(a){let n=await y.fetchCategories({search:a});if(n.data.data.length>0&&y.editCategory&&!n.data.data.find(p=>p.id==y.editCategory.id)){let p=Object.assign({},y.editCategory);n.data.data.unshift(p)}return n.data.data}async function X(a){let n=await _.fetchCustomers({search:a});if(n.data.data.length>0&&_.editCustomer&&!n.data.data.find(p=>p.id==_.editCustomer.id)){let p=Object.assign({},_.editCustomer);n.data.data.unshift(p)}return n.data.data}async function Y(){if(c.value||(t.currentExpense.currency_id=D.selectedCompanyCurrency.id,t.currentExpense.selectedCurrency=D.selectedCompanyCurrency),l.value=!0,await t.fetchPaymentModes({limit:"all"}),c.value){const a=await t.fetchExpense(v.params.id);t.currentExpense.currency_id=t.currentExpense.selectedCurrency.id,a.data&&(!y.editCategory&&a.data.data.expense_category&&(y.editCategory=a.data.data.expense_category),!_.editCustomer&&a.data.data.customer&&(_.editCustomer=a.data.data.customer))}else v.query.customer&&(t.currentExpense.customer_id=v.query.customer);l.value=!1}async function Z(){if(u.value.$touch(),u.value.$invalid)return;g.value=!0;let a={...t.currentExpense,expense_number:t.currentExpense.expense_number||""};try{c.value?await t.updateExpense({id:v.params.id,data:a,isAttachmentReceiptRemoved:M.value}):await t.addExpense(a),g.value=!1,t.currentExpense.attachment_receipt=null,M.value=!1,O.push("/admin/expenses")}catch(n){console.error(n),g.value=!1;return}}return ye(()=>{t.resetCurrentExpenseData(),_.editCustomer=null,y.editCategory=null}),(a,n)=>{const b=d("BaseBreadcrumbItem"),p=d("BaseBreadcrumb"),B=d("BaseIcon"),S=d("BaseButton"),ee=d("BasePageHeader"),te=d("BaseSelectAction"),V=d("BaseMultiselect"),m=d("BaseInputGroup"),ne=d("BaseDatePicker"),ae=d("BaseInput"),re=d("BaseMoney"),G=d("BaseInputGrid"),se=d("BaseTextarea"),oe=d("BaseFileUploader"),le=d("BaseCard"),ue=d("BasePage");return f(),fe(ve,null,[r(Ie),r(ue,{class:"relative"},{default:o(()=>[k("form",{action:"",onSubmit:Ce(Z,["prevent"])},[r(ee,{title:R.value,class:"mb-5"},{actions:o(()=>[c.value&&e(t).currentExpense.attachment_receipt_url?(f(),E(S,{key:0,href:H.value,tag:"a",variant:"primary-outline",type:"button",class:"mr-2"},{left:o(s=>[r(B,{name:"DownloadIcon",class:F(s.class)},null,8,["class"])]),default:o(()=>[w(" "+I(a.$t("expenses.download_receipt")),1)]),_:1},8,["href"])):C("",!0),k("div",Se,[r(S,{loading:e(g),"content-loading":e(l),disabled:e(g),variant:"primary",type:"submit"},{left:o(s=>[e(g)?C("",!0):(f(),E(B,{key:0,name:"ArrowDownOnSquareIcon",class:F(s.class)},null,8,["class"]))]),default:o(()=>[w(" "+I(c.value?a.$t("expenses.update_expense"):a.$t("expenses.save_expense")),1)]),_:1},8,["loading","content-loading","disabled"])])]),default:o(()=>[r(p,null,{default:o(()=>[r(b,{title:a.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),r(b,{title:a.$t("expenses.expense",2),to:"/admin/expenses"},null,8,["title"]),r(b,{title:R.value,to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),r(le,null,{default:o(()=>[r(G,null,{default:o(()=>[r(m,{label:a.$t("expenses.category"),error:e(u).currentExpense.expense_category_id.$error&&e(u).currentExpense.expense_category_id.$errors[0].$message,"content-loading":e(l),required:""},{default:o(()=>[e(l)?C("",!0):(f(),E(V,{key:0,modelValue:e(t).currentExpense.expense_category_id,"onUpdate:modelValue":n[0]||(n[0]=s=>e(t).currentExpense.expense_category_id=s),"content-loading":e(l),"value-prop":"id",label:"name","track-by":"id",options:W,"filter-results":!1,"resolve-on-load":"",delay:500,searchable:"",invalid:e(u).currentExpense.expense_category_id.$error,placeholder:a.$t("expenses.categories.select_a_category"),onInput:n[1]||(n[1]=s=>e(u).currentExpense.expense_category_id.$touch())},{action:o(()=>[r(te,{onClick:Q},{default:o(()=>[r(B,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),w(" "+I(a.$t("settings.expense_category.add_new_category")),1)]),_:1})]),_:1},8,["modelValue","content-loading","invalid","placeholder"]))]),_:1},8,["label","error","content-loading"]),r(m,{label:a.$t("expenses.expense_date"),error:e(u).currentExpense.expense_date.$error&&e(u).currentExpense.expense_date.$errors[0].$message,"content-loading":e(l),required:""},{default:o(()=>[r(ne,{modelValue:e(t).currentExpense.expense_date,"onUpdate:modelValue":n[2]||(n[2]=s=>e(t).currentExpense.expense_date=s),"content-loading":e(l),"calendar-button":!0,invalid:e(u).currentExpense.expense_date.$error,onInput:n[3]||(n[3]=s=>e(u).currentExpense.expense_date.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","error","content-loading"]),r(m,{label:a.$t("expenses.expense_number"),"content-loading":e(l)},{default:o(()=>[r(ae,{modelValue:e(t).currentExpense.expense_number,"onUpdate:modelValue":n[4]||(n[4]=s=>e(t).currentExpense.expense_number=s),"content-loading":e(l),type:"text",name:"expense_number",placeholder:a.$t("expenses.expense_number_placeholder")},null,8,["modelValue","content-loading","placeholder"])]),_:1},8,["label","content-loading"]),r(m,{label:a.$t("expenses.amount"),error:e(u).currentExpense.amount.$error&&e(u).currentExpense.amount.$errors[0].$message,"content-loading":e(l),required:""},{default:o(()=>[(f(),E(re,{key:e(t).currentExpense.selectedCurrency,modelValue:P.value,"onUpdate:modelValue":n[5]||(n[5]=s=>P.value=s),class:"focus:border focus:border-solid focus:border-primary-500",invalid:e(u).currentExpense.amount.$error,currency:e(t).currentExpense.selectedCurrency,onInput:n[6]||(n[6]=s=>e(u).currentExpense.amount.$touch())},null,8,["modelValue","invalid","currency"]))]),_:1},8,["label","error","content-loading"]),r(m,{label:a.$t("expenses.currency"),"content-loading":e(l),error:e(u).currentExpense.currency_id.$error&&e(u).currentExpense.currency_id.$errors[0].$message,required:""},{default:o(()=>[r(V,{modelValue:e(t).currentExpense.currency_id,"onUpdate:modelValue":[n[7]||(n[7]=s=>e(t).currentExpense.currency_id=s),J],"value-prop":"id",label:"name","track-by":"name","content-loading":e(l),options:e(U).currencies,searchable:"","can-deselect":!1,placeholder:a.$t("customers.select_currency"),invalid:e(u).currentExpense.currency_id.$error,class:"w-full"},null,8,["modelValue","content-loading","options","placeholder","invalid"])]),_:1},8,["label","content-loading","error"]),r(Me,{store:e(t),"store-prop":"currentExpense",v:e(u).currentExpense,"is-loading":e(l),"is-edit":c.value,"customer-currency":e(t).currentExpense.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"]),r(m,{"content-loading":e(l),label:a.$t("expenses.customer")},{default:o(()=>[e(l)?C("",!0):(f(),E(V,{key:0,modelValue:e(t).currentExpense.customer_id,"onUpdate:modelValue":n[8]||(n[8]=s=>e(t).currentExpense.customer_id=s),"content-loading":e(l),"value-prop":"id",label:"name","track-by":"id",options:X,"filter-results":!1,"resolve-on-load":"",delay:500,searchable:"",placeholder:a.$t("customers.select_a_customer")},null,8,["modelValue","content-loading","placeholder"]))]),_:1},8,["content-loading","label"]),r(m,{"content-loading":e(l),label:a.$t("payments.payment_mode")},{default:o(()=>[r(V,{modelValue:e(t).currentExpense.payment_method_id,"onUpdate:modelValue":n[9]||(n[9]=s=>e(t).currentExpense.payment_method_id=s),"content-loading":e(l),label:"name","value-prop":"id","track-by":"name",options:e(t).paymentModes,placeholder:a.$t("payments.select_payment_mode"),searchable:""},null,8,["modelValue","content-loading","options","placeholder"])]),_:1},8,["content-loading","label"])]),_:1}),r(G,{class:"mt-4"},{default:o(()=>[r(m,{"content-loading":e(l),label:a.$t("expenses.note"),error:e(u).currentExpense.notes.$error&&e(u).currentExpense.notes.$errors[0].$message},{default:o(()=>[r(se,{modelValue:e(t).currentExpense.notes,"onUpdate:modelValue":n[10]||(n[10]=s=>e(t).currentExpense.notes=s),"content-loading":e(l),row:4,rows:"4",onInput:n[11]||(n[11]=s=>e(u).currentExpense.notes.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["content-loading","label","error"]),r(m,{label:a.$t("expenses.receipt")},{default:o(()=>[r(oe,{modelValue:e(t).currentExpense.receiptFiles,"onUpdate:modelValue":n[12]||(n[12]=s=>e(t).currentExpense.receiptFiles=s),accept:"image/*,.doc,.docx,.pdf,.csv,.xlsx,.xls",onChange:z,onRemove:K},null,8,["modelValue"])]),_:1},8,["label"]),r(we,{"is-edit":c.value,class:"col-span-2","is-loading":e(l),type:"Expense",store:e(t),"store-prop":"currentExpense","custom-field-scope":j},null,8,["is-edit","is-loading","store"]),k("div",qe,[r(S,{loading:e(g),tabindex:6,variant:"primary",type:"submit",class:"flex justify-center w-full"},{left:o(s=>[e(g)?C("",!0):(f(),E(B,{key:0,name:"ArrowDownOnSquareIcon",class:F(s.class)},null,8,["class"]))]),default:o(()=>[w(" "+I(c.value?a.$t("expenses.update_expense"):a.$t("expenses.save_expense")),1)]),_:1},8,["loading"])])]),_:1})]),_:1})],32)]),_:1})],64)}}};export{je as default};
