import{G as A,u as L,aB as O,ar as T,at as F,N as J,v as K,e as S,I as R,j as g,f,g as _,J as X,i as H,P as Q,k as W,r as l,K as Y,o as Z,w as c,b as y,m as ee,a as s,l as a,q as $,t as h,M as te}from"./main-DnObvGgc.js";import{u as ae}from"./payment-COlo_rP3.js";const oe={class:"flex justify-between w-full"},ne={class:"px-8 py-8 sm:p-6"},se={class:"z-0 flex justify-end px-4 py-4 border-t border-solid border-gray-light"},le={__name:"NoteModal",setup(re){const d=A(),B=L(),e=O(),M=T(),V=ae(),C=F(),i=J(),{t:u}=K.useI18n();let m=S(!1);const q=R([{label:u("settings.customization.notes.types.invoice"),value:"Invoice"},{label:u("settings.customization.notes.types.estimate"),value:"Estimate"},{label:u("settings.customization.notes.types.payment"),value:"Payment"}]);let p=S(["customer","customerCustom"]);const z=g(()=>d.active&&d.componentName==="NoteModal"),E=g(()=>({currentNote:{name:{required:f.withMessage(u("validation.required"),_),minLength:f.withMessage(u("validation.name_min_length",{count:3}),X(3))},notes:{required:f.withMessage(u("validation.required"),_)},type:{required:f.withMessage(u("validation.required"),_)}}})),n=H(E,g(()=>e));Q(()=>e.currentNote.type,t=>{I()}),W(()=>{i.name==="estimates.create"?e.currentNote.type="Estimate":i.name==="invoices.create"||i.name==="recurring-invoices.create"?e.currentNote.type="Invoice":e.currentNote.type="Payment"});function I(){p.value=["customer","customerCustom"],e.currentNote.type=="Invoice"&&p.value.push("invoice","invoiceCustom"),e.currentNote.type=="Estimate"&&p.value.push("estimate","estimateCustom"),e.currentNote.type=="Payment"&&p.value.push("payment","paymentCustom")}async function P(){if(n.value.currentNote.$touch(),n.value.currentNote.$invalid)return!0;if(m.value=!0,e.isEdit){let t={id:e.currentNote.id,...e.currentNote};await e.updateNote(t).then(o=>{m.value=!1,o.data&&(B.showNotification({type:"success",message:u("settings.customization.notes.note_updated")}),d.refreshData&&d.refreshData(),v())}).catch(o=>{m.value=!1})}else await e.addNote(e.currentNote).then(t=>{m.value=!1,t.data&&(B.showNotification({type:"success",message:u("settings.customization.notes.note_added")}),(i.name==="invoices.create"&&t.data.data.type==="Invoice"||i.name==="invoices.edit"&&t.data.data.type==="Invoice")&&M.selectNote(t.data.data),(i.name==="estimates.create"&&t.data.data.type==="Estimate"||i.name==="estimates.edit"&&t.data.data.type==="Estimate")&&C.selectNote(t.data.data),(i.name==="payments.create"&&t.data.data.type==="Payment"||i.name==="payments.edit"&&t.data.data.type==="Payment")&&V.selectNote(t.data.data)),d.refreshData&&d.refreshData(),v()}).catch(t=>{m.value=!1})}function v(){d.closeModal(),setTimeout(()=>{e.resetCurrentNote(),n.value.$reset()},300)}return(t,o)=>{const w=l("BaseIcon"),k=l("BaseInput"),N=l("BaseInputGroup"),D=l("BaseMultiselect"),G=l("BaseSwitchSection"),j=l("BaseCustomInput"),U=l("BaseInputGrid"),b=l("BaseButton"),x=l("BaseModal");return Z(),Y(x,{show:z.value,onClose:v,onOpen:I},{header:c(()=>[y("div",oe,[$(h(a(d).title)+" ",1),s(w,{name:"XMarkIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:v})])]),default:c(()=>[y("form",{action:"",onSubmit:ee(P,["prevent"])},[y("div",ne,[s(U,{layout:"one-column"},{default:c(()=>[s(N,{label:t.$t("settings.customization.notes.name"),variant:"vertical",error:a(n).currentNote.name.$error&&a(n).currentNote.name.$errors[0].$message,required:""},{default:c(()=>[s(k,{modelValue:a(e).currentNote.name,"onUpdate:modelValue":o[0]||(o[0]=r=>a(e).currentNote.name=r),invalid:a(n).currentNote.name.$error,type:"text",onInput:o[1]||(o[1]=r=>a(n).currentNote.name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),s(N,{label:t.$t("settings.customization.notes.type"),error:a(n).currentNote.type.$error&&a(n).currentNote.type.$errors[0].$message,required:""},{default:c(()=>[s(D,{modelValue:a(e).currentNote.type,"onUpdate:modelValue":o[2]||(o[2]=r=>a(e).currentNote.type=r),options:q,"value-prop":"value",class:"mt-2"},null,8,["modelValue","options"])]),_:1},8,["label","error"]),s(G,{modelValue:a(e).currentNote.is_default,"onUpdate:modelValue":o[3]||(o[3]=r=>a(e).currentNote.is_default=r),title:t.$t("settings.customization.notes.is_default"),description:t.$t("settings.customization.notes.is_default_description"),_:""},null,8,["modelValue","title","description"]),s(N,{label:t.$t("settings.customization.notes.notes"),error:a(n).currentNote.notes.$error&&a(n).currentNote.notes.$errors[0].$message,required:""},{default:c(()=>[s(j,{modelValue:a(e).currentNote.notes,"onUpdate:modelValue":o[4]||(o[4]=r=>a(e).currentNote.notes=r),invalid:a(n).currentNote.notes.$error,fields:a(p),onInput:o[5]||(o[5]=r=>a(n).currentNote.notes.$touch())},null,8,["modelValue","invalid","fields"])]),_:1},8,["label","error"])]),_:1})]),y("div",se,[s(b,{class:"mr-2",variant:"primary-outline",type:"button",onClick:v},{default:c(()=>[$(h(t.$t("general.cancel")),1)]),_:1}),s(b,{loading:a(m),disabled:a(m),variant:"primary",type:"submit"},{left:c(r=>[s(w,{name:"ArrowDownOnSquareIcon",class:te(r.class)},null,8,["class"])]),default:c(()=>[$(" "+h(a(e).isEdit?t.$t("general.update"):t.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],32)]),_:1},8,["show"])}}};export{le as _};
