import{a9 as R,u as Y,v as F,N as Q,n as Z,O as ee,G as H,a7 as te,r as m,K as p,o as d,w as o,L as I,l as e,V as C,a,q as y,t as f,F as ae,e as N,I as oe,j as z,f as k,g as x,h as G,i as ne,c as O,b as M,M as re}from"./main-DnObvGgc.js";import{u as W}from"./payment-COlo_rP3.js";import{u as se}from"./mail-driver-DqYWSwW8.js";const be={__name:"PaymentIndexDropdown",props:{row:{type:Object,default:null},table:{type:Object,default:null},contentLoading:{type:Boolean,default:!1}},setup(_){const B=_,V=R(),w=Y(),{t:$}=F.useI18n(),v=W(),l=Q(),P=Z(),c=ee(),q=H(),r=te("utils");function T(i){V.openDialog({title:$("general.are_you_sure"),message:$("payments.confirm_delete",1),yesLabel:$("general.ok"),noLabel:$("general.cancel"),variant:"danger",size:"lg",hideNoButton:!1}).then(async t=>{if(t)return await v.deletePayment({ids:[i]}),P.push("/admin/payments"),B.table&&B.table.refresh(),!0})}function A(){var t;let i=`${window.location.origin}/payments/pdf/${(t=B.row)==null?void 0:t.unique_hash}`;r.copyTextToClipboard(i),w.showNotification({type:"success",message:$("general.copied_pdf_url_clipboard")})}async function E(i){q.openModal({title:$("payments.send_payment"),componentName:"SendPaymentModal",id:i.id,data:i,variant:"lg"})}return(i,t)=>{const b=m("BaseIcon"),L=m("BaseButton"),j=m("BaseDropdown-item"),g=m("BaseDropdownItem"),s=m("router-link"),n=m("BaseDropdown");return d(),p(n,{"content-loading":_.contentLoading},{activator:o(()=>[e(l).name==="payments.view"?(d(),p(L,{key:0,variant:"primary"},{default:o(()=>[a(b,{name:"EllipsisHorizontalIcon",class:"h-5 text-white"})]),_:1})):(d(),p(b,{key:1,name:"EllipsisHorizontalIcon",class:"h-5 text-gray-500"}))]),default:o(()=>[e(l).name==="payments.view"&&e(c).hasAbilities(e(C).VIEW_PAYMENT)?(d(),p(j,{key:0,class:"rounded-md",onClick:A},{default:o(()=>[a(b,{name:"LinkIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),y(" "+f(i.$t("general.copy_pdf_url")),1)]),_:1})):I("",!0),e(c).hasAbilities(e(C).EDIT_PAYMENT)?(d(),p(s,{key:1,to:`/admin/payments/${_.row.id}/edit`},{default:o(()=>[a(g,null,{default:o(()=>[a(b,{name:"PencilIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),y(" "+f(i.$t("general.edit")),1)]),_:1})]),_:1},8,["to"])):I("",!0),e(l).name!=="payments.view"&&e(c).hasAbilities(e(C).VIEW_PAYMENT)?(d(),p(s,{key:2,to:`/admin/payments/${_.row.id}/view`},{default:o(()=>[a(g,null,{default:o(()=>[a(b,{name:"EyeIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),y(" "+f(i.$t("general.view")),1)]),_:1})]),_:1},8,["to"])):I("",!0),_.row.status!=="SENT"&&e(l).name!=="payments.view"&&e(c).hasAbilities(e(C).SEND_PAYMENT)?(d(),p(g,{key:3,onClick:t[0]||(t[0]=h=>E(_.row))},{default:o(()=>[a(b,{name:"PaperAirplaneIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),y(" "+f(i.$t("payments.send_payment")),1)]),_:1})):I("",!0),e(c).hasAbilities(e(C).DELETE_PAYMENT)?(d(),p(g,{key:4,onClick:t[1]||(t[1]=h=>T(_.row.id))},{default:o(()=>[a(b,{name:"TrashIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),y(" "+f(i.$t("general.delete")),1)]),_:1})):I("",!0)]),_:1},8,["content-loading"])}}},le={class:"flex justify-between w-full"},ie={key:0,action:""},ue={class:"px-8 py-8 sm:p-6"},de={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},me={key:1},ce={class:"my-6 mx-4 border border-gray-200 relative"},pe=["src"],ye={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},_e={__name:"SendPaymentModal",setup(_){const B=W(),V=ae(),w=H(),$=Y();se(),R();const{t:v}=F.useI18n();let l=N(!1);const P=N(""),c=N(!1),q=N(["customer","customerCustom","payments","paymentsCustom","company"]),r=oe({id:null,from:null,to:null,subject:v("payments.new_payment"),body:null}),T=z(()=>w.active&&w.componentName==="SendPaymentModal"),A=z(()=>w.title),E=z(()=>w.data),i={from:{required:k.withMessage(v("validation.required"),x),email:k.withMessage(v("validation.email_incorrect"),G)},to:{required:k.withMessage(v("validation.required"),x),email:k.withMessage(v("validation.email_incorrect"),G)},subject:{required:k.withMessage(v("validation.required"),x)},body:{required:k.withMessage(v("validation.required"),x)}},t=ne(i,r);function b(){c.value=!1}async function L(){let s=await V.fetchBasicMailConfig();r.id=w.id,s.data&&(r.from=s.data.from_mail),E.value&&(r.to=E.value.customer.email),r.body=V.selectedCompanySettings.payment_mail_body}async function j(){if(t.value.$touch(),t.value.$invalid)return!0;try{if(l.value=!0,!c.value){const h=await B.previewPayment(r);l.value=!1,c.value=!0;var s=new Blob([h.data],{type:"text/html"});P.value=URL.createObjectURL(s);return}const n=await B.sendEmail(r);if(l.value=!1,n.data.success)return g(),!0}catch{l.value=!1,$.showNotification({type:"error",message:v("payments.something_went_wrong")})}}function g(){setTimeout(()=>{t.value.$reset(),c.value=!1,P.value=null,w.resetModalData()},300)}return(s,n)=>{const h=m("BaseIcon"),U=m("BaseInput"),D=m("BaseInputGroup"),K=m("BaseCustomInput"),X=m("BaseInputGrid"),S=m("BaseButton"),J=m("BaseModal");return d(),p(J,{show:T.value,onClose:g,onOpen:L},{header:o(()=>[M("div",le,[y(f(A.value)+" ",1),a(h,{name:"XMarkIcon",class:"w-6 h-6 text-gray-500 cursor-pointer",onClick:g})])]),default:o(()=>[c.value?(d(),O("div",me,[M("div",ce,[a(S,{class:"absolute top-4 right-4",disabled:e(l),variant:"primary-outline",onClick:b},{default:o(()=>[a(h,{name:"PencilIcon",class:"h-5 mr-2"}),y(" "+f(s.$t("general.edit")),1)]),_:1},8,["disabled"]),M("iframe",{src:P.value,frameborder:"0",class:"w-full",style:{"min-height":"500px"}},null,8,pe)]),M("div",ye,[a(S,{class:"mr-3",variant:"primary-outline",type:"button",onClick:g},{default:o(()=>[y(f(s.$t("general.cancel")),1)]),_:1}),a(S,{loading:e(l),disabled:e(l),variant:"primary",type:"button",onClick:n[7]||(n[7]=u=>j())},{default:o(()=>[e(l)?I("",!0):(d(),p(h,{key:0,name:"PaperAirplaneIcon",class:"h-5 mr-2"})),y(" "+f(s.$t("general.send")),1)]),_:1},8,["loading","disabled"])])])):(d(),O("form",ie,[M("div",ue,[a(X,{layout:"one-column",class:"col-span-7"},{default:o(()=>[a(D,{label:s.$t("general.from"),required:"",error:e(t).from.$error&&e(t).from.$errors[0].$message},{default:o(()=>[a(U,{modelValue:r.from,"onUpdate:modelValue":n[0]||(n[0]=u=>r.from=u),type:"text",invalid:e(t).from.$error,onInput:n[1]||(n[1]=u=>e(t).from.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),a(D,{label:s.$t("general.to"),required:"",error:e(t).to.$error&&e(t).to.$errors[0].$message},{default:o(()=>[a(U,{modelValue:r.to,"onUpdate:modelValue":n[2]||(n[2]=u=>r.to=u),type:"text",invalid:e(t).to.$error,onInput:n[3]||(n[3]=u=>e(t).to.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),a(D,{error:e(t).subject.$error&&e(t).subject.$errors[0].$message,label:s.$t("general.subject"),required:""},{default:o(()=>[a(U,{modelValue:r.subject,"onUpdate:modelValue":n[4]||(n[4]=u=>r.subject=u),type:"text",invalid:e(t).subject.$error,onInput:n[5]||(n[5]=u=>e(t).subject.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["error","label"]),a(D,{label:s.$t("general.body"),error:e(t).body.$error&&e(t).body.$errors[0].$message,required:""},{default:o(()=>[a(K,{modelValue:r.body,"onUpdate:modelValue":n[6]||(n[6]=u=>r.body=u),fields:q.value},null,8,["modelValue","fields"])]),_:1},8,["label","error"])]),_:1})]),M("div",de,[a(S,{class:"mr-3",variant:"primary-outline",type:"button",onClick:g},{default:o(()=>[y(f(s.$t("general.cancel")),1)]),_:1}),a(S,{loading:e(l),disabled:e(l),variant:"primary",type:"button",class:"mr-3",onClick:j},{left:o(u=>[e(l)?I("",!0):(d(),p(h,{key:0,class:re(u.class),name:"PhotoIcon"},null,8,["class"]))]),default:o(()=>[y(" "+f(s.$t("general.preview")),1)]),_:1},8,["loading","disabled"])])]))]),_:1},8,["show"])}}};export{_e as _,be as a};
