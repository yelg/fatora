import{v as ue,e as E,I as ce,F as ie,a9 as de,O as pe,j as k,ab as ye,ac as _e,K as y,w as t,r as l,o as _,a,L as T,ae as Y,q as d,t as i,l as u,M as B,af as L,V as f,a8 as j,b as p}from"./main-DnObvGgc.js";import{u as fe}from"./payment-COlo_rP3.js";import{_ as be}from"./CapsuleIcon-B4zIb7Vk.js";import{_ as ve,a as Be}from"./SendPaymentModal-CbyP2ue9.js";import"./mail-driver-DqYWSwW8.js";const he={class:"relative table-container"},ge={class:"relative flex items-center justify-end h-5"},ke={class:"flex text-sm font-medium cursor-pointer select-none text-primary-400"},Ce={class:"absolute items-center left-6 top-2.5 select-none"},Pe={class:"relative block"},Se={__name:"Index",setup(Ie){const{t:c}=ue.useI18n();let b=E(!1),C=E(!0),h=E(null);const m=ce({customer:"",payment_mode:"",payment_number:""}),o=fe();ie();const H=de(),P=pe(),A=k(()=>!o.paymentTotalCount&&!C.value),W=k(()=>[{key:"status",sortable:!1,thClass:"extra w-10",tdClass:"text-left text-sm font-medium extra"},{key:"payment_date",label:c("payments.date"),thClass:"extra",tdClass:"font-medium text-gray-900"},{key:"payment_number",label:c("payments.payment_number")},{key:"name",label:c("payments.customer")},{key:"payment_mode",label:c("payments.payment_mode")},{key:"invoice_number",label:c("payments.invoice")},{key:"amount",label:c("payments.amount")},{key:"actions",label:"",tdClass:"text-right text-sm font-medium",sortable:!1}]),S=k({get:()=>o.selectedPayments,set:n=>o.selectPayment(n)}),F=k({get:()=>o.selectAllField,set:n=>o.setSelectAllState(n)});ye(m,()=>{R()},{debounce:500}),_e(()=>{o.selectAllField&&o.selectAllPayments()}),o.fetchPaymentModes({limit:"all"});async function z(n){return(await o.fetchPaymentModes({search:n})).data.data}function G(){return P.hasAbilities([f.DELETE_PAYMENT,f.EDIT_PAYMENT,f.VIEW_PAYMENT,f.SEND_PAYMENT])}async function O({page:n,filter:s,sort:v}){let I={customer_id:m.customer_id,payment_method_id:m.payment_mode!==null?m.payment_mode:"",payment_number:m.payment_number,orderByField:v.fieldName||"created_at",orderBy:v.order||"desc",page:n};C.value=!0;let r=await o.fetchPayments(I);return C.value=!1,{data:r.data.data,pagination:{totalPages:r.data.meta.last_page,currentPage:n,totalCount:r.data.meta.total,limit:10}}}function M(){h.value&&h.value.refresh()}function R(){M()}function D(){m.customer_id="",m.payment_mode="",m.payment_number=""}function q(){b.value&&D(),b.value=!b.value}function K(){H.openDialog({title:c("general.are_you_sure"),message:c("payments.confirm_delete",2),yesLabel:c("general.ok"),noLabel:c("general.cancel"),variant:"danger",hideNoButton:!1,size:"lg"}).then(n=>{n&&o.deleteMultiplePayments().then(s=>{s.data.success&&M()})})}return(n,s)=>{const v=l("BaseBreadcrumbItem"),I=l("BaseBreadcrumb"),r=l("BaseIcon"),$=l("BaseButton"),X=l("BasePageHeader"),J=l("BaseCustomerSelectInput"),V=l("BaseInputGroup"),Q=l("BaseInput"),Z=l("BaseMultiselect"),ee=l("BaseFilterWrapper"),te=l("BaseEmptyPlaceholder"),ae=l("BaseDropdownItem"),ne=l("BaseDropdown"),N=l("BaseCheckbox"),le=l("router-link"),se=l("BaseText"),oe=l("BaseFormatMoney"),me=l("BaseTable"),re=l("BasePage");return _(),y(re,{class:"payments"},{default:t(()=>[a(ve),a(X,{title:n.$t("payments.title")},{actions:t(()=>[Y(a($,{variant:"primary-outline",onClick:q},{right:t(e=>[u(b)?(_(),y(r,{key:1,name:"XMarkIcon",class:B(e.class)},null,8,["class"])):(_(),y(r,{key:0,class:B(e.class),name:"FunnelIcon"},null,8,["class"]))]),default:t(()=>[d(i(n.$t("general.filter"))+" ",1)]),_:1},512),[[L,u(o).paymentTotalCount]]),u(P).hasAbilities(u(f).CREATE_PAYMENT)?(_(),y($,{key:0,variant:"primary",class:"ml-4",onClick:s[0]||(s[0]=e=>n.$router.push("/admin/payments/create"))},{left:t(e=>[a(r,{name:"PlusIcon",class:B(e.class)},null,8,["class"])]),default:t(()=>[d(" "+i(n.$t("payments.add_payment")),1)]),_:1})):T("",!0)]),default:t(()=>[a(I,null,{default:t(()=>[a(v,{title:n.$t("general.home"),to:"dashboard"},null,8,["title"]),a(v,{title:n.$t("payments.payment",2),to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),a(ee,{show:u(b),class:"mt-3",onClear:D},{default:t(()=>[a(V,{label:n.$t("payments.customer")},{default:t(()=>[a(J,{modelValue:m.customer_id,"onUpdate:modelValue":s[1]||(s[1]=e=>m.customer_id=e),placeholder:n.$t("customers.type_or_click"),"value-prop":"id",label:"name"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(V,{label:n.$t("payments.payment_number")},{default:t(()=>[a(Q,{modelValue:m.payment_number,"onUpdate:modelValue":s[2]||(s[2]=e=>m.payment_number=e)},{left:t(e=>[a(r,{name:"HashtagIcon",class:B(e.class)},null,8,["class"])]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(V,{label:n.$t("payments.payment_mode")},{default:t(()=>[a(Z,{modelValue:m.payment_mode,"onUpdate:modelValue":s[3]||(s[3]=e=>m.payment_mode=e),"value-prop":"id","track-by":"name","filter-results":!1,label:"name","resolve-on-load":"",delay:500,searchable:"",options:z},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["show"]),A.value?(_(),y(te,{key:0,title:n.$t("payments.no_payments"),description:n.$t("payments.list_of_payments")},j({default:t(()=>[a(be,{class:"mt-5 mb-4"})]),_:2},[u(P).hasAbilities(u(f).CREATE_PAYMENT)?{name:"actions",fn:t(()=>[a($,{variant:"primary-outline",onClick:s[4]||(s[4]=e=>n.$router.push("/admin/payments/create"))},{left:t(e=>[a(r,{name:"PlusIcon",class:B(e.class)},null,8,["class"])]),default:t(()=>[d(" "+i(n.$t("payments.add_new_payment")),1)]),_:1})]),key:"0"}:void 0]),1032,["title","description"])):T("",!0),Y(p("div",he,[p("div",ge,[u(o).selectedPayments.length?(_(),y(ne,{key:0},{activator:t(()=>[p("span",ke,[d(i(n.$t("general.actions"))+" ",1),a(r,{name:"ChevronDownIcon"})])]),default:t(()=>[a(ae,{onClick:K},{default:t(()=>[a(r,{name:"TrashIcon",class:"mr-3 text-gray-600"}),d(" "+i(n.$t("general.delete")),1)]),_:1})]),_:1})):T("",!0)]),a(me,{ref_key:"tableComponent",ref:h,data:O,columns:W.value,"placeholder-count":u(o).paymentTotalCount>=20?10:5,class:"mt-3"},j({header:t(()=>[p("div",Ce,[a(N,{modelValue:F.value,"onUpdate:modelValue":s[5]||(s[5]=e=>F.value=e),variant:"primary",onChange:u(o).selectAllPayments},null,8,["modelValue","onChange"])])]),"cell-status":t(({row:e})=>[p("div",Pe,[a(N,{id:e.id,modelValue:S.value,"onUpdate:modelValue":s[6]||(s[6]=g=>S.value=g),value:e.data.id,variant:"primary"},null,8,["id","modelValue","value"])])]),"cell-payment_date":t(({row:e})=>[d(i(e.data.formatted_payment_date),1)]),"cell-payment_number":t(({row:e})=>[a(le,{to:{path:`payments/${e.data.id}/view`},class:"font-medium text-primary-500"},{default:t(()=>[d(i(e.data.payment_number),1)]),_:2},1032,["to"])]),"cell-name":t(({row:e})=>[a(se,{text:e.data.customer.name,tag:"span"},null,8,["text"])]),"cell-payment_mode":t(({row:e})=>[p("span",null,i(e.data.payment_method?e.data.payment_method.name:"-"),1)]),"cell-invoice_number":t(({row:e})=>{var g,x,w,U;return[p("span",null,i((x=(g=e==null?void 0:e.data)==null?void 0:g.invoice)!=null&&x.invoice_number?(U=(w=e==null?void 0:e.data)==null?void 0:w.invoice)==null?void 0:U.invoice_number:"-"),1)]}),"cell-amount":t(({row:e})=>[a(oe,{amount:e.data.amount,currency:e.data.customer.currency},null,8,["amount","currency"])]),_:2},[G()?{name:"cell-actions",fn:t(({row:e})=>[a(Be,{row:e.data,table:u(h)},null,8,["row","table"])]),key:"0"}:void 0]),1032,["columns","placeholder-count"])],512),[[L,!A.value]])]),_:1})}}};export{Se as default};
