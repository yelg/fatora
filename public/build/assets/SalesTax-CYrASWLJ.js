import{av as ee,G as X,O as se,e as R,I as fe,a7 as ne,v as K,j as S,P as J,r as v,c as g,o,b as n,a,t as b,a8 as Ie,w as c,l as y,q as j,K as T,Q as F,L,F as Q,au as xe,N as Se,S as H,f as N,ah as te,aN as ke,g as G,i as re,R as Z,V as le,ap as ge,aS as Be,aT as me,aU as pe,aV as _e,ao as Te,aW as Me,M as W,T as Ce,aX as De,aY as Ve,at as je,u as Ee,J as qe,k as ve,m as be,H as Le}from"./main-DnObvGgc.js";import{D as Ae,d as Oe}from"./DragIcon-DZ4DjgJ9.js";import{_ as Ue}from"./SelectNotePopup-D_ZaygaK.js";const Ne={class:"flex items-center justify-between mb-3"},ze={class:"flex items-center text-base",style:{flex:"4"}},Fe={class:"pr-2 mb-0",align:"right"},Ye={class:"absolute left-3.5"},Ge={class:"ml-2 text-sm leading-none cursor-pointer text-primary-400"},We={class:"text-sm text-right",style:{flex:"3"}},Re={class:"flex items-center justify-center w-6 h-10 mx-2 cursor-pointer"},Xe={__name:"CreateItemRowTax",props:{ability:{type:String,default:""},store:{type:Object,default:null},storeProp:{type:String,default:""},itemIndex:{type:Number,required:!0},index:{type:Number,required:!0},taxData:{type:Object,required:!0},taxes:{type:Array,default:[]},total:{type:Number,default:0},totalTax:{type:Number,default:0},discountedTotal:{type:Number,default:0},currency:{type:[Object,String],required:!0},updateItems:{type:Function,default:()=>{}}},emits:["remove","update"],setup(t,{emit:_}){const e=t,l=_,k=ee(),h=X(),d=se(),B=R(null),$=fe({...e.taxData});ne("utils");const{t:f}=K.useI18n(),V=S(()=>k.taxTypes.map(r=>({...r})).map(r=>(e.taxes.find(p=>p.tax_type_id===r.id)?r.disabled=!0:r.disabled=!1,r))),M=S(()=>{if($.calculation_type==="fixed")return $.fixed_amount;if(e.discountedTotal){const m=e.store[e.storeProp].tax_per_item==="YES",r=e.store[e.storeProp].discount_per_item==="YES";return m&&!r?u():e.store[e.storeProp].tax_included?Math.round(e.discountedTotal-e.discountedTotal/(1+$.percent/100)):e.discountedTotal*$.percent/100}return 0});J(()=>e.discountedTotal,()=>{q()}),J(()=>e.totalTax,()=>{q()}),J(()=>M.value,()=>{q()}),e.taxData.tax_type_id>0&&(B.value=k.taxTypes.find(m=>m.id===e.taxData.tax_type_id)),q();function A(m){$.calculation_type=m.calculation_type,$.percent=m.calculation_type==="percentage"?m.percent:null,$.fixed_amount=m.calculation_type==="fixed"?m.fixed_amount:null,$.tax_type_id=m.id,$.name=m.name,q()}function q(){$.tax_type_id!==0&&l("update",{index:e.index,item:{...$,amount:M.value}})}function s(){let m={itemIndex:e.itemIndex,taxIndex:e.index};h.openModal({title:f("settings.tax_types.add_tax"),componentName:"TaxTypeModal",data:m,size:"sm"})}function x(m){e.store.$patch(r=>{r[e.storeProp].items[e.itemIndex].taxes.splice(m,1),r[e.storeProp].items[e.itemIndex].tax=0,r[e.storeProp].items[e.itemIndex].totalTax=0})}function u(){if($.calculation_type==="fixed")return $.fixed_amount;let m=0,r=0;const i=e.discountedTotal,p=e.store[e.storeProp].discount?e.store[e.storeProp].discount:0,C=e.store[e.storeProp].discount_type;let I=e.discountedTotal;if(p>0){e.store[e.storeProp].items.forEach(P=>{m+=P.total});const E=(i/m).toFixed(2);r=C==="fixed"?p*100:m*p/100;const D=Math.round(r*E);I=i-D}return e.store[e.storeProp].tax_included?Math.round(I-I/(1+$.percent/100)):Math.round(I*$.percent/100)}return(m,r)=>{const i=v("BaseFormatMoney"),p=v("BaseIcon"),C=v("BaseMultiselect");return o(),g("div",Ne,[n("div",ze,[n("label",Fe,b(m.$t("invoices.item.tax")),1),a(C,{modelValue:B.value,"onUpdate:modelValue":[r[0]||(r[0]=I=>B.value=I),r[1]||(r[1]=I=>A(I))],"value-prop":"id",options:V.value,placeholder:m.$t("general.select_a_tax"),"open-direction":"top","track-by":"name",searchable:"",object:"",label:"name"},Ie({singlelabel:c(({value:I})=>[n("div",Ye,[j(b(I.name)+" - ",1),I.calculation_type==="fixed"?(o(),T(i,{key:0,amount:I.fixed_amount,currency:t.currency},null,8,["amount","currency"])):(o(),g(F,{key:1},[j(b(I.percent)+" % ",1)],64))])]),option:c(({option:I})=>[j(b(I.name)+" - ",1),I.calculation_type==="fixed"?(o(),T(i,{key:0,amount:I.fixed_amount,currency:t.currency},null,8,["amount","currency"])):(o(),g(F,{key:1},[j(b(I.percent)+" % ",1)],64))]),_:2},[y(d).hasAbilities(t.ability)?{name:"action",fn:c(()=>[n("button",{type:"button",class:"flex items-center justify-center w-full px-2 py-2 bg-gray-200 border-none outline-none cursor-pointer",onClick:s},[a(p,{name:"CheckCircleIcon",class:"h-5 text-primary-400"}),n("label",Ge,b(m.$t("invoices.add_new_tax")),1)])]),key:"0"}:void 0]),1032,["modelValue","options","placeholder"]),r[3]||(r[3]=n("br",null,null,-1))]),n("div",We,[a(i,{amount:M.value,currency:t.currency},null,8,["amount","currency"])]),n("div",Re,[t.taxes.length&&t.index!==t.taxes.length-1?(o(),T(p,{key:0,name:"TrashIcon",class:"h-5 text-gray-700 cursor-pointer",onClick:r[2]||(r[2]=I=>x(t.index))})):L("",!0)])])}}},Ke={class:"box-border bg-white border border-gray-200 border-solid rounded-b"},He={colspan:"5",class:"p-0 text-left align-top"},Je={class:"w-full"},Qe={key:0,style:{width:"15%","min-width":"160px"}},Ze={class:"px-5 py-4 text-left align-top"},et={class:"flex justify-start"},tt={class:"flex items-center justify-center w-5 h-5 mt-2 mr-2 text-gray-300 cursor-move handle"},ot={class:"px-5 py-4 text-right align-top"},at={class:"px-5 py-4 text-left align-top"},st={class:"flex flex-col"},nt={class:"flex-auto flex-fill bd-highlight"},rt={class:"relative w-full"},lt={key:0,class:"px-5 py-4 text-left align-top"},it={class:"flex flex-col"},dt={class:"flex",style:{width:"120px"},role:"group"},ut={class:"flex items-center"},ct={class:"px-5 py-4 text-right align-top"},mt={class:"flex items-center justify-end text-sm"},pt={class:"flex items-center justify-center w-6 h-10 mx-2"},yt={key:0},ft={colspan:"4",class:"px-5 py-4 text-left align-top"},xt={__name:"CreateItemRow",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},itemData:{type:Object,default:null},index:{type:Number,default:null},type:{type:String,default:""},loading:{type:Boolean,default:!1},currency:{type:[Object,String],required:!0},invoiceItems:{type:Array,required:!0},itemValidationScope:{type:String,default:""}},emits:["update","remove","itemValidate"],setup(t,{emit:_}){const e=t,l=Q(),k=xe();Se();const{t:h}=K.useI18n(),d=S({get:()=>e.itemData.quantity,set:P=>{D("quantity",parseFloat(P))}}),B=S({get:()=>e.itemData.price/100,set:P=>{let w=Math.round(P*100);D("price",w),r()}}),$=S(()=>Math.round(e.itemData.price*e.itemData.quantity)),f=S({get:()=>e.itemData.discount,set:P=>{D("discount",P),r()}}),V=S(()=>$.value-e.itemData.discount_val),M=S(()=>e.currency?e.currency:l.selectedCompanyCurrency),A=S(()=>e.store[e.storeProp].items.length!=1),q=S(()=>Math.round(H.sumBy(e.itemData.taxes,function(P){return P.amount?P.amount:0}))),s=S(()=>q.value),x={name:{required:N.withMessage(h("validation.required"),G)},quantity:{required:N.withMessage(h("validation.required"),G),maxLength:N.withMessage(h("validation.amount_maxlength"),te(20))},price:{required:N.withMessage(h("validation.required"),G),maxLength:N.withMessage(h("validation.price_maxlength"),te(20))},discount_val:{between:N.withMessage(h("validation.discount_maxlength"),ke(0,S(()=>Math.abs($.value))))},description:{maxLength:N.withMessage(h("validation.notes_maxlength"),te(65e3))}},u=re(x,S(()=>e.store[e.storeProp].items[e.index]),{$scope:e.itemValidationScope});function m(P){e.store.$patch(U=>{U[e.storeProp].items[e.index].taxes[P.index]=P.item});let w=e.itemData.taxes[e.itemData.taxes.length-1];(w==null?void 0:w.tax_type_id)!==0&&e.store.$patch(U=>{U[e.storeProp].items[e.index].taxes.push({...Be,id:ge.raw()})}),E()}function r(){const P=e.store[e.storeProp].items[e.index].discount,w=Math.abs($.value);e.itemData.discount_type==="percentage"?D("discount_val",Math.round(w*P/100)):D("discount_val",Math.min(Math.round(P*100),w))}function i(P){D("name",P)}function p(P){e.store.$patch(w=>{if(w[e.storeProp].items[e.index].name=P.name,w[e.storeProp].items[e.index].price=P.price,w[e.storeProp].items[e.index].item_id=P.id,w[e.storeProp].items[e.index].description=P.description,P.unit&&(w[e.storeProp].items[e.index].unit_name=P.unit.name),e.store[e.storeProp].tax_per_item==="YES"&&P.taxes){let U=0;P.taxes.forEach(Y=>{m({index:U,item:{...Y}}),U++})}w[e.storeProp].exchange_rate&&(w[e.storeProp].items[e.index].price/=w[e.storeProp].exchange_rate)}),k.fetchItems(),E()}function C(){e.itemData.discount_type!=="fixed"&&(D("discount_val",Math.round(e.itemData.discount*100)),D("discount_type","fixed"))}function I(){e.itemData.discount_type!=="percentage"&&(D("discount_val",$.value*e.itemData.discount/100),D("discount_type","percentage"))}function E(){var U,Y;let P=(Y=(U=e.store[e.storeProp])==null?void 0:U.items[e.index])==null?void 0:Y.taxes;P||(P=[]);let w={...e.store[e.storeProp].items[e.index],index:e.index,total:V.value,sub_total:$.value,totalSimpleTax:q.value,totalTax:s.value,tax:s.value,taxes:[...P],tax_type_ids:P.flatMap(O=>O.tax_type_id?O.tax_type_id:[])};e.store.updateItem(w)}function D(P,w){e.store.$patch(U=>{U[e.storeProp].items[e.index][P]=w}),E()}return(P,w)=>{const U=v("BaseItemSelect"),Y=v("BaseInput"),O=v("BaseMoney"),ie=v("BaseIcon"),he=v("BaseButton"),de=v("BaseDropdownItem"),$e=v("BaseDropdown"),ue=v("BaseContentPlaceholdersText"),ce=v("BaseContentPlaceholders"),we=v("BaseFormatMoney");return o(),g("tr",Ke,[n("td",He,[n("table",Je,[n("colgroup",null,[w[6]||(w[6]=n("col",{style:{width:"40%","min-width":"280px"}},null,-1)),w[7]||(w[7]=n("col",{style:{width:"10%","min-width":"120px"}},null,-1)),w[8]||(w[8]=n("col",{style:{width:"15%","min-width":"120px"}},null,-1)),t.store[t.storeProp].discount_per_item==="YES"?(o(),g("col",Qe)):L("",!0),w[9]||(w[9]=n("col",{style:{width:"15%","min-width":"120px"}},null,-1))]),n("tbody",null,[n("tr",null,[n("td",Ze,[n("div",et,[n("div",tt,[a(Ae)]),a(U,{type:"Invoice",item:t.itemData,invalid:y(u).name.$error,"invalid-description":y(u).description.$error,taxes:t.itemData.taxes,index:t.index,"store-prop":t.storeProp,store:t.store,onSearch:i,onSelect:p},null,8,["item","invalid","invalid-description","taxes","index","store-prop","store"])])]),n("td",ot,[a(Y,{modelValue:d.value,"onUpdate:modelValue":w[0]||(w[0]=z=>d.value=z),invalid:y(u).quantity.$error,"content-loading":t.loading,type:"number",small:"",step:"any",onChange:w[1]||(w[1]=z=>E()),onInput:w[2]||(w[2]=z=>y(u).quantity.$touch())},null,8,["modelValue","invalid","content-loading"])]),n("td",at,[n("div",st,[n("div",nt,[n("div",rt,[(o(),T(O,{key:M.value,modelValue:B.value,"onUpdate:modelValue":w[3]||(w[3]=z=>B.value=z),invalid:y(u).price.$error,"content-loading":t.loading,currency:M.value},null,8,["modelValue","invalid","content-loading","currency"]))])])])]),t.store[t.storeProp].discount_per_item==="YES"?(o(),g("td",lt,[n("div",it,[n("div",dt,[a(Y,{modelValue:f.value,"onUpdate:modelValue":w[4]||(w[4]=z=>f.value=z),invalid:y(u).discount_val.$error,"content-loading":t.loading,class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue","invalid","content-loading"]),a($e,{position:"bottom-end"},{activator:c(()=>[a(he,{"content-loading":t.loading,class:"rounded-tr-md rounded-br-md !p-2 rounded-none",type:"button",variant:"white"},{default:c(()=>[n("span",ut,[j(b(t.itemData.discount_type=="fixed"?t.currency.symbol:"%")+" ",1),a(ie,{name:"ChevronDownIcon",class:"w-4 h-4 ml-1 text-gray-500"})])]),_:1},8,["content-loading"])]),default:c(()=>[a(de,{onClick:C},{default:c(()=>[j(b(P.$t("general.fixed")),1)]),_:1}),a(de,{onClick:I},{default:c(()=>[j(b(P.$t("general.percentage")),1)]),_:1})]),_:1})])])])):L("",!0),n("td",ct,[n("div",mt,[n("span",null,[t.loading?(o(),T(ce,{key:0},{default:c(()=>[a(ue,{lines:1,class:"w-16 h-5"})]),_:1})):(o(),T(we,{key:1,amount:V.value,currency:M.value},null,8,["amount","currency"]))]),n("div",pt,[A.value?(o(),T(ie,{key:0,class:"h-5 text-gray-700 cursor-pointer",name:"TrashIcon",onClick:w[5]||(w[5]=z=>t.store.removeItem(t.index))})):L("",!0)])])])]),t.store[t.storeProp].tax_per_item==="YES"?(o(),g("tr",yt,[w[10]||(w[10]=n("td",{class:"px-5 py-4 text-left align-top"},null,-1)),n("td",ft,[t.loading?(o(),T(ce,{key:0},{default:c(()=>[a(ue,{lines:1,class:"w-24 h-8 border rounded-md"})]),_:1})):(o(!0),g(F,{key:1},Z(t.itemData.taxes,(z,Pe)=>(o(),T(Xe,{key:z.id,index:Pe,"item-index":t.index,"tax-data":z,taxes:t.itemData.taxes,"discounted-total":V.value,"total-tax":q.value,total:$.value,currency:t.currency,"update-items":E,ability:y(le).CREATE_INVOICE,store:t.store,"store-prop":t.storeProp,discount:f.value,onUpdate:m},null,8,["index","item-index","tax-data","taxes","discounted-total","total-tax","total","currency","ability","store","store-prop","discount"]))),128))])])):L("",!0)])])])])}}},gt={key:0,class:"flex items-center justify-end w-full px-6 text-base border border-b-0 border-gray-200 border-solid cursor-pointer text-primary-400 bg-white"},_t={class:"text-center item-table min-w-full"},vt={key:0,style:{width:"15%","min-width":"160px"}},bt={class:"bg-white border border-gray-200 border-solid"},ht={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},$t={key:1,class:"pl-7"},wt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},Pt={key:1},It={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},St={key:1},kt={key:0,class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Bt={key:1},Tt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},Mt={key:1,class:"pr-10 column-heading"},No={__name:"CreateItems",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},currency:{type:[Object,String,null],required:!0},isLoading:{type:Boolean,default:!1},itemValidationScope:{type:String,default:""}},setup(t){const _=t,e=Q(),l=S(()=>_.currency?_.currency:e.selectedCompanyCurrency),k=S({get:()=>_.store[_.storeProp].tax_included,set:async h=>{_.store[_.storeProp].tax_included=h}});return(h,d)=>{const B=v("BaseSwitchSection"),$=v("BaseContentPlaceholdersText"),f=v("BaseContentPlaceholders"),V=v("BaseIcon");return o(),g(F,null,[y(e).selectedCompanySettings.tax_included==="YES"?(o(),g("div",gt,[a(B,{modelValue:k.value,"onUpdate:modelValue":d[0]||(d[0]=M=>k.value=M),title:h.$t("settings.tax_types.tax_included"),store:t.store,"store-prop":t.storeProp},null,8,["modelValue","title","store","store-prop"])])):L("",!0),n("table",_t,[n("colgroup",null,[d[3]||(d[3]=n("col",{style:{width:"40%","min-width":"280px"}},null,-1)),d[4]||(d[4]=n("col",{style:{width:"10%","min-width":"120px"}},null,-1)),d[5]||(d[5]=n("col",{style:{width:"15%","min-width":"120px"}},null,-1)),t.store[t.storeProp].discount_per_item==="YES"?(o(),g("col",vt)):L("",!0),d[6]||(d[6]=n("col",{style:{width:"15%","min-width":"120px"}},null,-1))]),n("thead",bt,[n("tr",null,[n("th",ht,[t.isLoading?(o(),T(f,{key:0},{default:c(()=>[a($,{lines:1,class:"w-16 h-5"})]),_:1})):(o(),g("span",$t,b(h.$t("items.item",2)),1))]),n("th",wt,[t.isLoading?(o(),T(f,{key:0},{default:c(()=>[a($,{lines:1,class:"w-16 h-5"})]),_:1})):(o(),g("span",Pt,b(h.$t("invoices.item.quantity")),1))]),n("th",It,[t.isLoading?(o(),T(f,{key:0},{default:c(()=>[a($,{lines:1,class:"w-16 h-5"})]),_:1})):(o(),g("span",St,b(h.$t("invoices.item.price")),1))]),t.store[t.storeProp].discount_per_item==="YES"?(o(),g("th",kt,[t.isLoading?(o(),T(f,{key:0},{default:c(()=>[a($,{lines:1,class:"w-16 h-5"})]),_:1})):(o(),g("span",Bt,b(h.$t("invoices.item.discount")),1))])):L("",!0),n("th",Tt,[t.isLoading?(o(),T(f,{key:0},{default:c(()=>[a($,{lines:1,class:"w-16 h-5"})]),_:1})):(o(),g("span",Mt,b(h.$t("invoices.item.amount")),1))])])]),a(y(Oe),{modelValue:t.store[t.storeProp].items,"onUpdate:modelValue":d[1]||(d[1]=M=>t.store[t.storeProp].items=M),"item-key":"id",tag:"tbody",handle:".handle"},{item:c(({element:M,index:A})=>[(o(),T(xt,{key:M.id,index:A,"item-data":M,loading:t.isLoading,currency:l.value,"item-validation-scope":t.itemValidationScope,"invoice-items":t.store[t.storeProp].items,store:t.store,"store-prop":t.storeProp},null,8,["index","item-data","loading","currency","item-validation-scope","invoice-items","store","store-prop"]))]),_:1},8,["modelValue"])]),n("div",{class:"flex items-center justify-center w-full px-6 py-3 text-base border border-t-0 border-gray-200 border-solid cursor-pointer text-primary-400 hover:bg-primary-100",onClick:d[2]||(d[2]=(...M)=>t.store.addItem&&t.store.addItem(...M))},[a(V,{name:"PlusCircleIcon",class:"mr-2"}),j(" "+b(h.$t("general.add_new_item")),1)])],64)}}},Ct={key:0,class:"flex items-center justify-between w-full"},Dt={key:1,class:"text-sm font-semibold leading-5 text-gray-500 uppercase"},Vt={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},ye={__name:"NetTotal",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},currency:{type:[Object,String],default:""},isLoading:{type:Boolean,default:!1}},setup(t){return(_,e)=>t.store[t.storeProp].tax_included?(o(),g("div",Ct,[t.isLoading?(o(),T(pe,{key:0},{default:c(()=>[a(me,{lines:1,class:"w-16 h-5"})]),_:1})):(o(),g("label",Dt,b(_.$t("estimates.net_total")),1)),t.isLoading?(o(),T(pe,{key:2},{default:c(()=>[a(me,{lines:1,class:"w-16 h-5"})]),_:1})):(o(),g("label",Vt,[a(_e,{amount:t.store.getNetTotal,currency:t.currency},null,8,["amount","currency"])]))])):L("",!0)}},jt={class:"flex items-center justify-between w-full mt-2 text-sm"},Et={key:0,class:"font-semibold leading-5 text-gray-500 uppercase"},qt={key:1,class:"font-semibold leading-5 text-gray-500 uppercase"},Lt={class:"flex items-center justify-center text-lg text-black"},At={__name:"CreateTotalTaxes",props:{index:{type:Number,required:!0},tax:{type:Object,required:!0},taxes:{type:Array,required:!0},currency:{type:[Object,String],required:!0},store:{type:Object,default:null},storeProp:{type:String,default:""},data:{type:String,default:""}},emits:["update","remove"],setup(t,{emit:_}){const e=t,l=_;ne("$utils");const k=S(()=>e.tax.calculation_type==="fixed"?e.tax.fixed_amount:e.tax.compound_tax&&e.store.getSubtotalWithDiscount?Math.round((e.store.getSubtotalWithDiscount+e.store.getTotalSimpleTax)*e.tax.percent/100):e.store.getSubtotalWithDiscount&&e.tax.percent&&e.store[e.storeProp].tax_included?Math.round(e.store.getSubtotalWithDiscount-e.store.getSubtotalWithDiscount/(1+e.tax.percent/100)):e.store.getSubtotalWithDiscount&&e.tax.percent?Math.round(e.store.getSubtotalWithDiscount*e.tax.percent/100):0);Te(()=>{e.store.getSubtotalWithDiscount&&h(),e.store.getTotalSimpleTax&&h()}),J(()=>e.store[e.storeProp].tax_included,d=>{h()},{deep:!0});function h(){l("update",{...e.tax,amount:k.value})}return(d,B)=>{const $=v("BaseFormatMoney"),f=v("BaseIcon");return o(),g("div",jt,[t.tax.calculation_type==="percentage"?(o(),g("label",Et,b(t.tax.name)+" ("+b(t.tax.percent)+" %) ",1)):(o(),g("label",qt,[j(b(t.tax.name)+" (",1),a($,{amount:t.tax.fixed_amount,currency:t.currency},null,8,["amount","currency"]),B[1]||(B[1]=j(") "))])),n("label",Lt,[a($,{amount:t.tax.amount,currency:t.currency},null,8,["amount","currency"]),a(f,{name:"TrashIcon",class:"h-5 ml-2 cursor-pointer",onClick:B[0]||(B[0]=V=>d.$emit("remove",t.tax.id))})])])}}},Ot={class:"w-full mt-4 tax-select"},Ut={class:"relative w-full max-w-md px-4"},Nt={class:"overflow-hidden rounded-md shadow-lg ring-1 ring-black ring-opacity-5"},zt={class:"relative bg-white"},Ft={class:"relative p-4"},Yt={key:0,class:"relative flex flex-col overflow-auto list max-h-36 border-t border-gray-200"},Gt=["onClick"],Wt={class:"flex justify-between px-2"},Rt={class:"m-0 text-base font-semibold leading-tight text-gray-700 cursor-pointer"},Xt={class:"m-0 text-base font-semibold text-gray-700 cursor-pointer"},Kt={key:1,class:"flex justify-center p-5 text-gray-400"},Ht={class:"text-base text-gray-500 cursor-pointer"},Jt={class:"m-0 ml-3 text-sm leading-none cursor-pointer font-base text-primary-400"},Qt={__name:"SelectTaxPopup",props:{type:{type:String,default:null},store:{type:Object,default:null},storeProp:{type:String,default:""}},emits:["select:taxType"],setup(t,{emit:_}){const e=t,l=_,k=X(),h=ee(),d=se(),B=Q(),{t:$}=K.useI18n(),f=R(null),V=S(()=>f.value?h.taxTypes.filter(function(s){return s.name.toLowerCase().indexOf(f.value.toLowerCase())!==-1}):h.taxTypes),M=S(()=>e.store[e.storeProp].taxes);function A(s,x){l("select:taxType",{...s}),x()}function q(){k.openModal({title:$("settings.tax_types.add_tax"),componentName:"TaxTypeModal",size:"sm",refreshData:s=>l("select:taxType",s)})}return(s,x)=>{const u=v("BaseIcon"),m=v("BaseInput");return o(),g("div",Ot,[a(y(Ve),{class:"relative"},{default:c(({isOpen:r})=>[a(y(Me),{class:W([r?"":"text-opacity-90","flex items-center text-sm font-medium text-primary-400 focus:outline-none focus:border-none"])},{default:c(()=>[a(u,{name:"PlusIcon",class:"w-4 h-4 font-medium text-primary-400"}),j(" "+b(s.$t("settings.tax_types.add_tax")),1)]),_:2},1032,["class"]),n("div",Ut,[a(Ce,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:c(()=>[a(y(De),{style:{"min-width":"350px","margin-left":"62px",top:"-28px"},class:"absolute z-10 px-4 py-2 -translate-x-full sm:px-0"},{default:c(({close:i})=>[n("div",Nt,[n("div",zt,[n("div",Ft,[a(m,{modelValue:f.value,"onUpdate:modelValue":x[0]||(x[0]=p=>f.value=p),placeholder:s.$t("general.search"),type:"text",class:"text-black"},null,8,["modelValue","placeholder"])]),V.value.length>0?(o(),g("div",Yt,[(o(!0),g(F,null,Z(V.value,(p,C)=>(o(),g("div",{key:C,class:W([{"bg-gray-100 cursor-not-allowed opacity-50 pointer-events-none":M.value.find(I=>I.tax_type_id===p.id)},"px-6 py-4 border-b border-gray-200 border-solid cursor-pointer hover:bg-gray-100 hover:cursor-pointer last:border-b-0"]),tabindex:"2",onClick:I=>A(p,i)},[n("div",Wt,[n("label",Rt,b(p.name),1),n("label",Xt,[p.calculation_type==="fixed"?(o(),T(_e,{key:0,amount:p.fixed_amount,currency:y(B).selectedCompanyCurrency},null,8,["amount","currency"])):(o(),g(F,{key:1},[j(b(p.percent)+" % ",1)],64))])])],10,Gt))),128))])):(o(),g("div",Kt,[n("label",Ht,b(s.$t("general.no_tax_found")),1)]))]),y(d).hasAbilities(y(le).CREATE_TAX_TYPE)?(o(),g("button",{key:0,type:"button",class:"flex items-center justify-center w-full h-10 px-2 py-3 bg-gray-200 border-none outline-none",onClick:q},[a(u,{name:"CheckCircleIcon",class:"text-primary-400"}),n("label",Jt,b(s.$t("estimates.add_new_tax")),1)])):L("",!0)])]),_:1})]),_:1})])]),_:1})])}}},Zt={class:"px-5 py-4 mt-6 bg-white border border-gray-200 border-solid rounded md:min-w-[390px] min-w-[300px] lg:mt-7"},eo={class:"flex items-center justify-between w-full"},to={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},oo={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},ao={key:0},so={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-500 uppercase"},no={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},ro={key:1,class:"flex items-center justify-between w-full mt-2"},lo={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},io={key:3,class:"flex",style:{width:"140px"},role:"group"},uo={class:"flex items-center"},co={key:2,class:"flex items-center justify-between w-full mt-2"},mo={key:3},po={class:"flex items-center justify-between w-full pt-2 mt-5 border-t border-gray-200 border-solid"},yo={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-400 uppercase"},fo={key:3,class:"flex items-center justify-center text-lg uppercase text-primary-400"},zo={__name:"CreateTotal",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},taxPopupType:{type:String,default:""},currency:{type:[Object,String],default:""},isLoading:{type:Boolean,default:!1}},setup(t){const _=R(null),e=t;ne("$utils");const l=Q();J(()=>e.store[e.storeProp].items,s=>{$()},{deep:!0});const k=S({get:()=>e.store[e.storeProp].discount,set:s=>{e.store[e.storeProp].discount=s,$()}}),h=S({get:()=>e.store[e.storeProp].taxes,set:s=>{e.store.$patch(x=>{x[e.storeProp].taxes=s})}}),d=S(()=>{let s=[];return e.store[e.storeProp].items.forEach(x=>{x.taxes&&x.taxes.forEach(u=>{let m=s.find(r=>r.tax_type_id===u.tax_type_id);m?m.amount+=u.amount:u.tax_type_id&&s.push({tax_type_id:u.tax_type_id,amount:Math.round(u.amount),percent:u.percent,name:u.name,calculation_type:u.calculation_type,fixed_amount:u.fixed_amount})})}),s}),B=S(()=>e.currency?e.currency:l.selectedCompanyCurrency);function $(){const s=e.store[e.storeProp].discount;if(e.store[e.storeProp].discount_type==="percentage"){e.store[e.storeProp].discount_val=Math.round(e.store.getSubTotal*s/100);return}e.store[e.storeProp].discount_val=Math.round(s*100)}function f(){e.store[e.storeProp].discount_type!=="fixed"&&(e.store[e.storeProp].discount_val=Math.round(e.store[e.storeProp].discount*100),e.store[e.storeProp].discount_type="fixed")}function V(){if(e.store[e.storeProp].discount_type==="percentage")return;const s=Math.round(e.store[e.storeProp].discount*100)/100;e.store[e.storeProp].discount_val=Math.round(e.store.getSubTotal*s/100),e.store[e.storeProp].discount_type="percentage"}function M(s){let x=0;s.calculation_type==="percentage"&&e.store.getSubtotalWithDiscount&&s.percent?x=Math.round(e.store.getSubtotalWithDiscount*s.percent/100):s.calculation_type==="fixed"&&(x=s.fixed_amount);let u={...le,id:ge.raw(),name:s.name,percent:s.percent,tax_type_id:s.id,amount:x,calculation_type:s.calculation_type,fixed_amount:s.fixed_amount};e.store.$patch(m=>{m[e.storeProp].taxes.push({...u})})}function A(s){const x=e.store[e.storeProp].taxes.find(u=>u.id===s.id);x&&Object.assign(x,{...s})}function q(s){const x=e.store[e.storeProp].taxes.findIndex(u=>u.id===s);e.store.$patch(u=>{u[e.storeProp].taxes.splice(x,1)})}return(s,x)=>{const u=v("BaseContentPlaceholdersText"),m=v("BaseContentPlaceholders"),r=v("BaseFormatMoney"),i=v("BaseInput"),p=v("BaseIcon"),C=v("BaseButton"),I=v("BaseDropdownItem"),E=v("BaseDropdown");return o(),g("div",Zt,[n("div",eo,[t.isLoading?(o(),T(m,{key:0},{default:c(()=>[a(u,{lines:1,class:"w-16 h-5"})]),_:1})):(o(),g("label",to,b(s.$t("estimates.sub_total")),1)),t.isLoading?(o(),T(m,{key:2},{default:c(()=>[a(u,{lines:1,class:"w-16 h-5"})]),_:1})):(o(),g("label",oo,[a(r,{amount:t.store.getSubTotal,currency:B.value},null,8,["amount","currency"])]))]),t.store[t.storeProp].tax_per_item==="YES"?(o(),g("div",ao,[a(ye,{currency:t.currency,store:t.store,storeProp:t.storeProp,isLoading:t.isLoading},null,8,["currency","store","storeProp","isLoading"])])):L("",!0),(o(!0),g(F,null,Z(d.value,D=>(o(),g("div",{key:D.tax_type_id,class:"flex items-center justify-between w-full"},[t.isLoading?(o(),T(m,{key:0},{default:c(()=>[a(u,{lines:1,class:"w-16 h-5"})]),_:1})):t.store[t.storeProp].tax_per_item==="YES"?(o(),g("label",so,[D.calculation_type==="percentage"?(o(),g(F,{key:0},[j(b(D.name)+" - "+b(D.percent)+"% ",1)],64)):(o(),g(F,{key:1},[j(b(D.name)+" - ",1),a(r,{amount:D.fixed_amount,currency:B.value},null,8,["amount","currency"])],64))])):L("",!0),t.isLoading?(o(),T(m,{key:2},{default:c(()=>[a(u,{lines:1,class:"w-16 h-5"})]),_:1})):t.store[t.storeProp].tax_per_item==="YES"?(o(),g("label",no,[a(r,{amount:D.amount,currency:B.value},null,8,["amount","currency"])])):L("",!0)]))),128)),t.store[t.storeProp].discount_per_item==="NO"||t.store[t.storeProp].discount_per_item===null?(o(),g("div",ro,[t.isLoading?(o(),T(m,{key:0},{default:c(()=>[a(u,{lines:1,class:"w-16 h-5"})]),_:1})):(o(),g("label",lo,b(s.$t("estimates.discount")),1)),t.isLoading?(o(),T(m,{key:2},{default:c(()=>[a(u,{lines:1,class:"w-24 h-8 border rounded-md"})]),_:1})):(o(),g("div",io,[a(i,{modelValue:k.value,"onUpdate:modelValue":x[0]||(x[0]=D=>k.value=D),class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue"]),a(E,{position:"bottom-end"},{activator:c(()=>[a(C,{class:"p-2 rounded-none rounded-tr-md rounded-br-md",type:"button",variant:"white"},{default:c(()=>[n("span",uo,[j(b(t.store[t.storeProp].discount_type=="fixed"?B.value.symbol:"%")+" ",1),a(p,{name:"ChevronDownIcon",class:"w-4 h-4 ml-1 text-gray-500"})])]),_:1})]),default:c(()=>[a(I,{onClick:f},{default:c(()=>[j(b(s.$t("general.fixed")),1)]),_:1}),a(I,{onClick:V},{default:c(()=>[j(b(s.$t("general.percentage")),1)]),_:1})]),_:1})]))])):L("",!0),t.store[t.storeProp].tax_per_item==="NO"||t.store[t.storeProp].tax_per_item===null?(o(),g("div",co,[a(ye,{currency:t.currency,store:t.store,storeProp:t.storeProp,isLoading:t.isLoading},null,8,["currency","store","storeProp","isLoading"])])):L("",!0),t.store[t.storeProp].tax_per_item==="NO"||t.store[t.storeProp].tax_per_item===null?(o(),g("div",mo,[(o(!0),g(F,null,Z(h.value,(D,P)=>(o(),T(At,{key:D.id,index:P,tax:D,taxes:h.value,currency:t.currency,store:t.store,storeProp:t.storeProp,onRemove:q,onUpdate:A},null,8,["index","tax","taxes","currency","store","storeProp"]))),128))])):L("",!0),t.store[t.storeProp].tax_per_item==="NO"||t.store[t.storeProp].tax_per_item===null?(o(),g("div",{key:4,ref_key:"taxModal",ref:_,class:"float-right pt-2 pb-4"},[a(Qt,{"store-prop":t.storeProp,store:t.store,type:t.taxPopupType,"onSelect:taxType":M},null,8,["store-prop","store","type"])],512)):L("",!0),n("div",po,[t.isLoading?(o(),T(m,{key:0},{default:c(()=>[a(u,{lines:1,class:"w-16 h-5"})]),_:1})):(o(),g("label",yo,b(s.$t("estimates.total"))+" "+b(s.$t("estimates.amount"))+":",1)),t.isLoading?(o(),T(m,{key:2},{default:c(()=>[a(u,{lines:1,class:"w-16 h-5"})]),_:1})):(o(),g("label",fo,[a(r,{amount:t.store.getTotal,currency:B.value},null,8,["amount","currency"])]))])])}}},xo={class:"flex text-gray-800 font-medium text-sm mb-2"},Fo={__name:"SelectTemplateButton",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},isMarkAsDefault:{type:Boolean,default:!1}},setup(t){const _=t,e=X(),{t:l}=K.useI18n();function k(){let h="";_.storeProp=="newEstimate"?h=l("estimates.mark_as_default_estimate_template_description"):_.storeProp=="newInvoice"&&(h=l("invoices.mark_as_default_invoice_template_description")),e.openModal({title:l("general.choose_template"),componentName:"SelectTemplate",data:{templates:_.store.templates,store:_.store,storeProp:_.storeProp,isMarkAsDefault:_.isMarkAsDefault,markAsDefaultDescription:h}})}return(h,d)=>{const B=v("BaseIcon"),$=v("BaseButton");return o(),g("div",null,[n("label",xo,[j(b(h.$t("general.select_template"))+" ",1),d[0]||(d[0]=n("span",{class:"text-sm text-red-500"}," *",-1))]),a($,{type:"button",class:"flex justify-center w-full text-sm lg:w-auto hover:bg-gray-200",variant:"gray",onClick:k},{right:c(f=>[a(B,{name:"PencilIcon",class:W(f.class)},null,8,["class"])]),default:c(()=>[j(" "+b(t.store[t.storeProp].template_name),1)]),_:1})])}}},go={class:"mb-6"},_o={class:"z-20 text-sm font-semibold leading-5 text-primary-400 float-right"},vo={class:"text-gray-800 font-medium mb-4 text-sm"},Yo={__name:"CreateNotesField",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},fields:{type:Object,default:null},type:{type:String,default:null}},setup(t){const _=t;function e(l){_.store[_.storeProp].notes=""+l.notes}return(l,k)=>{const h=v("BaseCustomInput");return o(),g("div",go,[n("div",_o,[a(Ue,{type:t.type,onSelect:e},null,8,["type"])]),n("label",vo,b(l.$t("invoices.notes")),1),a(h,{modelValue:t.store[t.storeProp].notes,"onUpdate:modelValue":k[0]||(k[0]=d=>t.store[t.storeProp].notes=d),"content-loading":t.store.isFetchingInitialSettings,fields:t.fields,class:"mt-1"},null,8,["modelValue","content-loading","fields"])])}}},bo={class:"flex justify-between w-full"},ho={class:"px-8 py-8 sm:p-6"},$o={key:0,class:"grid grid-cols-3 gap-2 p-1 overflow-x-auto"},wo=["onClick"],Po=["src","alt"],Io=["alt","src"],So={key:1,class:"z-0 flex ml-3 pt-5"},ko={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Go={__name:"SelectTemplateModal",setup(t){const _=X(),e=se(),l=R(""),k=S(()=>_.active&&_.componentName==="SelectTemplate"),h=S(()=>_.title);function d(){_.data.store[_.data.storeProp].template_name?l.value=_.data.store[_.data.storeProp].template_name:l.value=_.data.templates[0]}async function B(){await _.data.store.setTemplate(l.value),!_.data.store.isEdit&&_.data.isMarkAsDefault&&(_.data.storeProp=="newEstimate"?await e.updateUserSettings({settings:{default_estimate_template:l.value}}):_.data.storeProp=="newInvoice"&&await e.updateUserSettings({settings:{default_invoice_template:l.value}})),f()}function $(){return new URL("/build/assets/tick-BkKo8A3q.png",import.meta.url)}function f(){_.closeModal(),setTimeout(()=>{_.$reset()},300)}return(V,M)=>{const A=v("BaseIcon"),q=v("BaseCheckbox"),s=v("BaseButton"),x=v("BaseModal");return o(),T(x,{show:k.value,onClose:f,onOpen:d},{header:c(()=>[n("div",bo,[j(b(h.value)+" ",1),a(A,{name:"XMarkIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:f})])]),default:c(()=>[n("div",ho,[y(_).data?(o(),g("div",$o,[(o(!0),g(F,null,Z(y(_).data.templates,(u,m)=>(o(),g("div",{key:m,class:W([{"border border-solid border-primary-500":l.value===u.name},"relative flex flex-col m-2 border border-gray-200 border-solid cursor-pointer hover:border-primary-300"]),onClick:r=>l.value=u.name},[n("img",{src:u.path,alt:u.name,class:"w-full min-h-[100px]"},null,8,Po),l.value===u.name?(o(),g("img",{key:0,alt:u.name,class:"absolute z-10 w-5 h-5 text-primary-500",style:{top:"-6px",right:"-5px"},src:$()},null,8,Io)):L("",!0),n("span",{class:W(["w-full p-1 bg-gray-200 text-sm text-center absolute bottom-0 left-0",{"text-primary-500 bg-primary-100":l.value===u.name,"text-gray-600":l.value!=u.name}])},b(u.name),3)],10,wo))),128))])):L("",!0),y(_).data.store.isEdit?L("",!0):(o(),g("div",So,[a(q,{modelValue:y(_).data.isMarkAsDefault,"onUpdate:modelValue":M[0]||(M[0]=u=>y(_).data.isMarkAsDefault=u),"set-initial-value":!1,variant:"primary",label:V.$t("general.mark_as_default"),description:y(_).data.markAsDefaultDescription},null,8,["modelValue","label","description"])]))]),n("div",ko,[a(s,{class:"mr-3",variant:"primary-outline",onClick:f},{default:c(()=>[j(b(V.$t("general.cancel")),1)]),_:1}),a(s,{variant:"primary",onClick:M[1]||(M[1]=u=>B())},{left:c(u=>[a(A,{name:"ArrowDownOnSquareIcon",class:W(u.class)},null,8,["class"])]),default:c(()=>[j(" "+b(V.$t("general.choose")),1)]),_:1})])]),_:1},8,["show"])}}},Bo={class:"flex justify-between w-full"},To={class:"item-modal"},Mo={class:"px-8 py-8 sm:p-6"},Co={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Wo={__name:"ItemModal",emits:["newItem"],setup(t,{emit:_}){const e=X(),l=xe(),k=Q(),h=ee();je(),Ee();const{t:d}=K.useI18n(),B=R(!1),$=R(k.selectedCompanySettings.tax_per_item),f=S(()=>e.active&&e.componentName==="ItemModal"),V=S({get:()=>l.currentItem.price/100,set:r=>{l.currentItem.price=Math.round(r*100)}}),M=S({get:()=>l.currentItem.taxes.map(r=>{if(r)return{...r,tax_type_id:r.id,tax_name:r.name+" ("+(r.calculation_type==="fixed"?r.fixed_amount:r.percent)+(r.calculation_type==="fixed"?k.selectedCompanyCurrency.symbol:"%")+")"}}),set:r=>{l.$patch(i=>{i.currentItem.taxes=r})}}),A=S(()=>$.value==="YES"),q={name:{required:N.withMessage(d("validation.required"),G),minLength:N.withMessage(d("validation.name_min_length",{count:3}),qe(3))},description:{maxLength:N.withMessage(d("validation.description_maxlength",{count:255}),te(255))}},s=re(q,S(()=>l.currentItem)),x=S(()=>h.taxTypes.map(r=>{const i=r.calculation_type==="fixed"?new Intl.NumberFormat(void 0,{style:"currency",currency:k.selectedCompanyCurrency.code}).format(r.fixed_amount/100):`${r.percent}%`;return{...r,tax_name:`${r.name} (${i})`}}));ve(()=>{s.value.$reset(),l.fetchItemUnits({limit:"all"})});async function u(){if(s.value.$touch(),s.value.$invalid)return!0;let r={...l.currentItem,taxes:l.currentItem.taxes.map(p=>({tax_type_id:p.id,amount:p.calculation_type==="fixed"?p.fixed_amount:Math.round(V.value*p.percent),percent:p.percent,fixed_amount:p.fixed_amount,calculation_type:p.calculation_type,name:p.name,collective_tax:0}))};B.value=!0,await(l.isEdit?l.updateItem:l.addItem)(r).then(p=>{B.value=!1,p.data.data&&e.data&&e.refreshData(p.data.data),m()})}function m(){e.closeModal(),setTimeout(()=>{l.resetCurrentItem(),e.$reset(),s.value.$reset()},300)}return(r,i)=>{const p=v("BaseIcon"),C=v("BaseInput"),I=v("BaseInputGroup"),E=v("BaseMoney"),D=v("BaseMultiselect"),P=v("BaseTextarea"),w=v("BaseInputGrid"),U=v("BaseButton"),Y=v("BaseModal");return o(),T(Y,{show:f.value,onClose:m},{header:c(()=>[n("div",Bo,[j(b(y(e).title)+" ",1),a(p,{name:"XMarkIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:m})])]),default:c(()=>[n("div",To,[n("form",{action:"",onSubmit:be(u,["prevent"])},[n("div",Mo,[a(w,{layout:"one-column"},{default:c(()=>[a(I,{label:r.$t("items.name"),required:"",error:y(s).name.$error&&y(s).name.$errors[0].$message},{default:c(()=>[a(C,{modelValue:y(l).currentItem.name,"onUpdate:modelValue":i[0]||(i[0]=O=>y(l).currentItem.name=O),type:"text",invalid:y(s).name.$error,onInput:i[1]||(i[1]=O=>y(s).name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),a(I,{label:r.$t("items.price")},{default:c(()=>[(o(),T(E,{key:y(k).selectedCompanyCurrency,modelValue:V.value,"onUpdate:modelValue":i[2]||(i[2]=O=>V.value=O),currency:y(k).selectedCompanyCurrency,class:"relative w-full focus:border focus:border-solid focus:border-primary"},null,8,["modelValue","currency"]))]),_:1},8,["label"]),a(I,{label:r.$t("items.unit")},{default:c(()=>[a(D,{modelValue:y(l).currentItem.unit_id,"onUpdate:modelValue":i[3]||(i[3]=O=>y(l).currentItem.unit_id=O),label:"name",options:y(l).itemUnits,"value-prop":"id","can-deselect":!1,"can-clear":!1,placeholder:r.$t("items.select_a_unit"),searchable:"","track-by":"name"},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),A.value?(o(),T(I,{key:0,label:r.$t("items.taxes")},{default:c(()=>[a(D,{modelValue:M.value,"onUpdate:modelValue":i[4]||(i[4]=O=>M.value=O),options:x.value,mode:"tags",label:"tax_name","value-prop":"id",class:"w-full","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"tax_name",object:""},null,8,["modelValue","options"])]),_:1},8,["label"])):L("",!0),a(I,{label:r.$t("items.description"),error:y(s).description.$error&&y(s).description.$errors[0].$message},{default:c(()=>[a(P,{modelValue:y(l).currentItem.description,"onUpdate:modelValue":i[5]||(i[5]=O=>y(l).currentItem.description=O),rows:"4",cols:"50",invalid:y(s).description.$error,onInput:i[6]||(i[6]=O=>y(s).description.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"])]),_:1})]),n("div",Co,[a(U,{class:"mr-3",variant:"primary-outline",type:"button",onClick:m},{default:c(()=>[j(b(r.$t("general.cancel")),1)]),_:1}),a(U,{loading:B.value,disabled:B.value,variant:"primary",type:"submit"},{left:c(O=>[a(p,{name:"ArrowDownOnSquareIcon",class:W(O.class)},null,8,["class"])]),default:c(()=>[j(" "+b(y(l).isEdit?r.$t("general.update"):r.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],32)])]),_:1},8,["show"])}}},Do={class:"flex justify-between w-full"},Vo={class:"flex flex-col"},jo={class:"text-sm text-gray-500 mt-1"},Eo={class:"p-4 sm:p-6"},qo={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Lo={__name:"TaxationAddressModal",emits:["addTax"],setup(t,{emit:_}){const e=X();Le();const l=fe({state:"",city:"",address_street_1:"",zip:""}),k=R(!1),h=ee(),{t:d}=K.useI18n(),B=S(()=>e.active&&e.componentName==="TaxationAddressModal"),$=S(()=>({state:{required:N.withMessage(d("validation.required"),G)},city:{required:N.withMessage(d("validation.required"),G)},address_street_1:{required:N.withMessage(d("validation.required"),G)},zip:{required:N.withMessage(d("validation.required"),G)}})),f=re($,S(()=>l));async function V(){if(f.value.$touch(),f.value.$invalid)return!0;let s={address:l};e.id&&(s.customer_id=e.id),l.address_street_1=l.address_street_1.replace(/(\r\n|\n|\r)/gm,""),k.value=!0,await h.fetchSalesTax(s).then(x=>{k.value=!1,M("addTax",x.data.data),q()}).catch(x=>{k.value=!1})}const M=_;function A(){var s,x,u,m;l.state=(s=e==null?void 0:e.data)==null?void 0:s.state,l.city=(x=e==null?void 0:e.data)==null?void 0:x.city,l.address_street_1=(u=e==null?void 0:e.data)==null?void 0:u.address_street_1,l.zip=(m=e==null?void 0:e.data)==null?void 0:m.zip}function q(){e.closeModal()}return(s,x)=>{const u=v("BaseIcon"),m=v("BaseInput"),r=v("BaseInputGroup"),i=v("BaseTextarea"),p=v("BaseInputGrid"),C=v("BaseButton"),I=v("BaseModal");return o(),T(I,{show:B.value,onClose:q,onOpen:A},{header:c(()=>[n("div",Do,[n("div",Vo,[j(b(y(e).title)+" ",1),n("p",jo,b(y(e).content),1)]),a(u,{name:"XMarkIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:q})])]),default:c(()=>[n("form",{onSubmit:be(V,["prevent"])},[n("div",Eo,[a(p,{layout:"one-column"},{default:c(()=>[a(r,{required:"",error:y(f).state.$error&&y(f).state.$errors[0].$message,label:s.$t("customers.state")},{default:c(()=>[a(m,{modelValue:l.state,"onUpdate:modelValue":x[0]||(x[0]=E=>l.state=E),type:"text",name:"shippingState",class:"mt-1 md:mt-0",invalid:y(f).state.$error,onInput:x[1]||(x[1]=E=>y(f).state.$touch()),placeholder:s.$t("settings.taxations.state_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),a(r,{required:"",error:y(f).city.$error&&y(f).city.$errors[0].$message,label:s.$t("customers.city")},{default:c(()=>[a(m,{modelValue:l.city,"onUpdate:modelValue":x[2]||(x[2]=E=>l.city=E),type:"text",name:"shippingCity",class:"mt-1 md:mt-0",invalid:y(f).city.$error,onInput:x[3]||(x[3]=E=>y(f).city.$touch()),placeholder:s.$t("settings.taxations.city_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),a(r,{required:"",error:y(f).address_street_1.$error&&y(f).address_street_1.$errors[0].$message,label:s.$t("customers.address")},{default:c(()=>[a(i,{modelValue:l.address_street_1,"onUpdate:modelValue":x[4]||(x[4]=E=>l.address_street_1=E),rows:"2",cols:"50",class:"mt-1 md:mt-0",invalid:y(f).address_street_1.$error,onInput:x[5]||(x[5]=E=>y(f).address_street_1.$touch()),placeholder:s.$t("settings.taxations.address_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),a(r,{required:"",error:y(f).zip.$error&&y(f).zip.$errors[0].$message,label:s.$t("customers.zip_code")},{default:c(()=>[a(m,{modelValue:l.zip,"onUpdate:modelValue":x[6]||(x[6]=E=>l.zip=E),invalid:y(f).zip.$error,onInput:x[7]||(x[7]=E=>y(f).zip.$touch()),type:"text",class:"mt-1 md:mt-0",placeholder:s.$t("settings.taxations.zip_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"])]),_:1})]),n("div",qo,[a(C,{class:"mr-3 text-sm",type:"button",variant:"primary-outline",onClick:q},{default:c(()=>[j(b(s.$t("general.cancel")),1)]),_:1}),a(C,{loading:k.value,variant:"primary",type:"submit"},{left:c(E=>[k.value?L("",!0):(o(),T(u,{key:0,name:"ArrowDownOnSquareIcon",class:W(E.class)},null,8,["class"]))]),default:c(()=>[j(" "+b(s.$t("general.save")),1)]),_:1},8,["loading"])])],32)]),_:1},8,["show"])}}},oe="Sales Tax",ae="MODULE",Ro={__name:"SalesTax",props:{isEdit:{type:Boolean,default:null},type:{type:String,default:null},customer:{type:[Object],default:null},store:{type:Object,default:null},storeProp:{type:String,default:null}},setup(t){const _=X(),e=Q(),l=ee(),{t:k}=K.useI18n(),h=R(!1),d=t,B=S(()=>d.isEdit?d.store[d.storeProp].sales_tax_address_type==="billing":e.selectedCompanySettings.sales_tax_address_type==="billing"),$=S(()=>e.selectedCompanySettings.sales_tax_us_enabled==="YES"),f=S(()=>d.isEdit?d.store[d.storeProp].sales_tax_type==="customer_level":e.selectedCompanySettings.sales_tax_type==="customer_level"),V=S(()=>d.isEdit?d.store[d.storeProp].sales_tax_type==="company_level":e.selectedCompanySettings.sales_tax_type==="company_level"),M=S(()=>{if(f.value&&A.value){let i=B.value?d.customer.billing:d.customer.shipping;return{address:H.pick(i,["address_street_1","city","state","zip"]),customer_id:d.customer.id}}else if(V.value&&A.value)return{address:H.pick(address,["address_street_1","city","state","zip"])}}),A=S(()=>{var i,p;if(f.value){let C=B.value?(i=d.customer)==null?void 0:i.billing:(p=d.customer)==null?void 0:p.shipping;return q(C)}else if(V.value)return q(e.selectedCompany.address);return!1});J(()=>d.customer,(i,p)=>{if(i&&p&&f.value){s(i,p);return}!A.value&&f.value&&i?setTimeout(()=>{x()},500):f.value&&i?u():f.value&&!i&&r()}),ve(()=>{V.value&&(A.value?u():x())});function q(i){return i?i.address_street_1&&i.city&&i.state&&i.zip:!1}function s(i,p){const C=B.value?i.billing:i.shipping,I=B.value?p.billing:p.shipping,E=H.pick(C,["address_street_1","city","state","zip"]),D=H.pick(I,["address_street_1","city","state","zip"]);H.isEqual(E,D)||u()}function x(){var C,I;if(!$.value)return;let i=null,p="";f.value?B.value?(i=(C=d.customer)==null?void 0:C.billing,p=k("settings.taxations.add_billing_address")):(i=(I=d.customer)==null?void 0:I.shipping,p=k("settings.taxations.add_shipping_address")):(i=e.selectedCompany.address,p=k("settings.taxations.add_company_address")),_.openModal({title:p,content:k("settings.taxations.modal_description"),componentName:"TaxationAddressModal",data:i,id:f.value?d.customer.id:""})}async function u(){$.value&&(h.value=!0,await l.fetchSalesTax(M.value).then(i=>{m(i.data.data),h.value=!1}).catch(i=>{i.response.data.error&&setTimeout(()=>{x()},500),h.value=!1}))}function m(i){i.tax_type_id=i.id;const p=d.store[d.storeProp].taxes.findIndex(C=>C.name===oe&&C.type===ae);p>-1?Object.assign(d.store[d.storeProp].taxes[p],i):d.store[d.storeProp].taxes.push(i)}function r(){const i=d.store[d.storeProp].taxes.findIndex(C=>C.name===oe&&C.type===ae);i>-1&&d.store[d.storeProp].taxes.splice(i,1);let p=l.taxTypes.findIndex(C=>C.name===oe&&C.type===ae);p>-1&&l.taxTypes.splice(p,1)}return(i,p)=>(o(),T(Lo,{onAddTax:m}))}};export{Ro as _,Go as a,Wo as b,No as c,Yo as d,Fo as e,zo as f};
